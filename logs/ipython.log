2025-12-13 15:55:11,751 INFO ipython warehouse_json_path = os.path.join(frappe.get_app_path("erpnext"), "stock", "doctype", "warehouse", "warehouse.json")
2025-12-13 15:55:11,752 INFO ipython if os.path.exists(warehouse_json_path):
    print(f"‚úÖ Found warehouse.json at: {warehouse_json_path}")
    
2025-12-13 15:55:11,752 INFO ipython     with open(warehouse_json_path, 'r') as f:
        warehouse_data = json.load(f)
    
2025-12-13 15:55:11,752 INFO ipython     # Check if already exists
2025-12-13 15:55:11,752 INFO ipython     if frappe.db.exists("DocType", "Warehouse"):
        print("‚úÖ Warehouse doctype already exists in database")
        dt = frappe.get_doc("DocType", "Warehouse")
        print(f"   Module: {dt.module}")
    else:
        print("Creating Warehouse doctype...")
        try:
            dt = frappe.get_doc(warehouse_data)
            dt.insert(ignore_permissions=True, ignore_links=True)
            frappe.db.commit()
            print("‚úÖ Warehouse doctype installed successfully!")
        except Exception as e:
            print(f"‚ùå Error installing: {e}")
            print("   Trying alternative method...")
            # Try via import_doc
            from frappe.modules import import_doc
            try:
                import_doc("erpnext.stock.doctype.warehouse.warehouse")
                frappe.db.commit()
                print("‚úÖ Warehouse doctype installed via import_doc!")
            except Exception as e2:
                print(f"‚ùå Alternative method also failed: {e2}")
else:
    print(f"‚ùå warehouse.json not found at: {warehouse_json_path}")
2025-12-13 15:55:11,752 INFO ipython frappe.db.close()
2025-12-13 15:55:11,752 INFO ipython === session end ===
2025-12-13 15:55:31,881 INFO ipython === bench console session ===
2025-12-13 15:55:31,882 INFO ipython import frappe
2025-12-13 15:55:31,882 INFO ipython import json
2025-12-13 15:55:31,882 INFO ipython import os
2025-12-13 15:55:31,882 INFO ipython frappe.init(site='lending.localhost')
2025-12-13 15:55:31,882 INFO ipython frappe.connect()
2025-12-13 15:55:31,882 INFO ipython print("=== Installing Warehouse Doctype ===")
2025-12-13 15:55:31,882 INFO ipython # Check if exists
2025-12-13 15:55:31,882 INFO ipython if frappe.db.exists("DocType", "Warehouse"):
    print("‚úÖ Warehouse doctype already exists")
    dt = frappe.get_doc("DocType", "Warehouse")
    print(f"   Name: {dt.name}")
    print(f"   Module: {dt.module}")
else:
    print("‚ùå Warehouse doctype not found. Installing...")
    
2025-12-13 15:55:31,882 INFO ipython     # Get warehouse.json path
2025-12-13 15:55:31,882 INFO ipython     warehouse_json = os.path.join(
        frappe.get_app_path("erpnext"),
        "stock", "doctype", "warehouse", "warehouse.json"
    )
2025-12-13 15:55:31,882 INFO ipython     if os.path.exists(warehouse_json):
        print(f"‚úÖ Found warehouse.json")
        with open(warehouse_json, 'r') as f:
            warehouse_data = json.load(f)
        
2025-12-13 15:55:31,882 INFO ipython         try:
            # Create doctype
            dt = frappe.get_doc(warehouse_data)
            dt.insert(ignore_permissions=True, ignore_links=True, ignore_validate=True)
            frappe.db.commit()
            print("‚úÖ Warehouse doctype installed!")
        except Exception as e:
            print(f"‚ùå Error: {e}")
            print("   Trying via import_doc...")
            try:
                from frappe.modules import import_doc
                import_doc("erpnext.stock.doctype.warehouse.warehouse")
                frappe.db.commit()
                print("‚úÖ Warehouse doctype installed via import_doc!")
            except Exception as e2:
                print(f"‚ùå Alternative method failed: {e2}")
    else:
        print(f"‚ùå warehouse.json not found at: {warehouse_json}")
2025-12-13 15:55:31,882 INFO ipython # Verify
2025-12-13 15:55:31,882 INFO ipython if frappe.db.exists("DocType", "Warehouse"):
    print("\n‚úÖ Verification: Warehouse doctype is now installed!")
else:
    print("\n‚ùå Verification: Warehouse doctype still not installed")
    print("   You may need to run: bench --site lending.localhost migrate")
2025-12-13 15:55:31,882 INFO ipython frappe.db.close()
2025-12-13 15:55:31,882 INFO ipython === session end ===
2025-12-13 16:03:05,151 INFO ipython === bench console session ===
2025-12-13 16:03:05,151 INFO ipython import frappe
2025-12-13 16:03:05,151 INFO ipython frappe.init(site='lending.localhost')
2025-12-13 16:03:05,151 INFO ipython frappe.connect()
2025-12-13 16:03:05,151 INFO ipython print("=== Installing Warehouse Doctype ===")
2025-12-13 16:03:05,151 INFO ipython # Check if Warehouse exists
2025-12-13 16:03:05,151 INFO ipython if frappe.db.exists("DocType", "Warehouse"):
    print("‚úÖ Warehouse doctype already exists!")
    dt = frappe.get_doc("DocType", "Warehouse")
    print(f"   Name: {dt.name}")
    print(f"   Module: {dt.module}")
else:
    print("Installing Warehouse doctype...")
    
2025-12-13 16:03:05,151 INFO ipython     # Method 1: Try importing from module
2025-12-13 16:03:05,151 INFO ipython     try:
        from frappe.modules import import_doc
        import_doc("erpnext.stock.doctype.warehouse.warehouse")
        frappe.db.commit()
        print("‚úÖ Warehouse installed via import_doc!")
    except Exception as e1:
        print(f"Method 1 failed: {e1}")
        
2025-12-13 16:03:05,151 INFO ipython         # Method 2: Try installing via doctype sync
2025-12-13 16:03:05,151 INFO ipython         try:
            from frappe.core.doctype.doctype.doctype import sync_doctype
            sync_doctype("Warehouse", force=True)
            frappe.db.commit()
            print("‚úÖ Warehouse installed via sync_doctype!")
        except Exception as e2:
            print(f"Method 2 failed: {e2}")
            
2025-12-13 16:03:05,151 INFO ipython             # Method 3: Direct installation from JSON
2025-12-13 16:03:05,151 INFO ipython             try:
                import json
                import os
                warehouse_json = os.path.join(
                    frappe.get_app_path("erpnext"),
                    "stock", "doctype", "warehouse", "warehouse.json"
                )
                
                if os.path.exists(warehouse_json):
                    with open(warehouse_json, 'r') as f:
                        warehouse_data = json.load(f)
                    
                    # Create doctype
                    dt = frappe.get_doc(warehouse_data)
                    dt.flags.ignore_links = True
                    dt.flags.ignore_validate = True
                    dt.insert(ignore_permissions=True)
                    frappe.db.commit()
                    print("‚úÖ Warehouse installed from JSON!")
                else:
                    print(f"‚ùå warehouse.json not found at: {warehouse_json}")
            except Exception as e3:
                print(f"Method 3 failed: {e3}")
2025-12-13 16:03:05,151 INFO ipython # Verify installation
2025-12-13 16:03:05,151 INFO ipython if frappe.db.exists("DocType", "Warehouse"):
    print("\n‚úÖ SUCCESS: Warehouse doctype is now installed!")
    dt = frappe.get_doc("DocType", "Warehouse")
    print(f"   Module: {dt.module}")
    print(f"   App: {dt.app_name if hasattr(dt, 'app_name') else 'N/A'}")
else:
    print("\n‚ùå Warehouse doctype still not installed")
    print("   You may need to complete ERPNext setup wizard")
2025-12-13 16:03:05,152 INFO ipython frappe.db.close()
2025-12-13 16:03:05,152 INFO ipython === session end ===
2025-12-13 16:03:09,058 INFO ipython === bench console session ===
2025-12-13 16:03:09,058 INFO ipython import frappe
2025-12-13 16:03:09,058 INFO ipython frappe.init(site='lending.localhost')
2025-12-13 16:03:09,059 INFO ipython frappe.connect()
2025-12-13 16:03:09,059 INFO ipython # Test if Warehouse can be imported
2025-12-13 16:03:09,059 INFO ipython try:
    from erpnext.stock.doctype.warehouse.warehouse import Warehouse
    print("‚úÖ Warehouse class can be imported")
    
    # Test if doctype exists
    if frappe.db.exists("DocType", "Warehouse"):
        print("‚úÖ Warehouse doctype exists in database")
        
        # Try to get a warehouse doc (should not fail)
        try:
            # Just test if we can create the controller
            warehouse_dt = frappe.get_doc("DocType", "Warehouse")
            print(f"‚úÖ Warehouse doctype loaded: {warehouse_dt.name}")
            print(f"   Module: {warehouse_dt.module}")
            print("\nüéâ Warehouse is ready! Company creation should work now.")
        except Exception as e:
            print(f"‚ùå Error loading Warehouse doctype: {e}")
    else:
        print("‚ùå Warehouse doctype still not in database")
except Exception as e:
    print(f"‚ùå Error importing Warehouse: {e}")
2025-12-13 16:03:09,059 INFO ipython frappe.db.close()
2025-12-13 16:03:09,059 INFO ipython === session end ===
2025-12-13 16:03:31,004 INFO ipython === bench console session ===
2025-12-13 16:03:31,005 INFO ipython import frappe
2025-12-13 16:03:31,005 INFO ipython frappe.init(site='lending.localhost')
2025-12-13 16:03:31,005 INFO ipython frappe.connect()
2025-12-13 16:03:31,005 INFO ipython print("=== Installing Stock Module ===")
2025-12-13 16:03:31,005 INFO ipython # Check if Stock module exists
2025-12-13 16:03:31,005 INFO ipython if frappe.db.exists("Module Def", "Stock"):
    print("‚úÖ Stock module already exists")
    module = frappe.get_doc("Module Def", "Stock")
    print(f"   Name: {module.name}")
    print(f"   App: {module.app_name}")
else:
    print("Installing Stock module...")
    
2025-12-13 16:03:31,005 INFO ipython     # Create Stock module
2025-12-13 16:03:31,005 INFO ipython     try:
        module = frappe.get_doc({
            "doctype": "Module Def",
            "module_name": "Stock",
            "app_name": "erpnext",
            "custom": 0
        })
        module.insert(ignore_permissions=True)
        frappe.db.commit()
        print("‚úÖ Stock module installed!")
    except Exception as e:
        print(f"Error installing Stock module: {e}")
        # Try to get it from ERPNext
        try:
            # Check if module file exists
            import os
            module_path = os.path.join(
                frappe.get_app_path("erpnext"),
                "modules.txt"
            )
            if os.path.exists(module_path):
                print("Found modules.txt, checking if Stock is listed...")
                with open(module_path, 'r') as f:
                    modules = [line.strip() for line in f if line.strip()]
                if "Stock" in modules:
                    print("Stock is in modules.txt, trying to sync...")
                    # Try syncing modules
                    frappe.reload_doc("erpnext", "module", "stock")
                    frappe.db.commit()
                    print("‚úÖ Stock module synced!")
        except Exception as e2:
            print(f"Alternative method failed: {e2}")
2025-12-13 16:03:31,005 INFO ipython # Verify
2025-12-13 16:03:31,005 INFO ipython if frappe.db.exists("Module Def", "Stock"):
    print("\n‚úÖ SUCCESS: Stock module is now installed!")
else:
    print("\n‚ùå Stock module still not installed")
2025-12-13 16:03:31,005 INFO ipython frappe.db.close()
2025-12-13 16:03:31,005 INFO ipython === session end ===
2025-12-13 16:03:34,800 INFO ipython === bench console session ===
2025-12-13 16:03:34,800 INFO ipython import frappe
2025-12-13 16:03:34,800 INFO ipython frappe.init(site='lending.localhost')
2025-12-13 16:03:34,800 INFO ipython frappe.connect()
2025-12-13 16:03:34,801 INFO ipython print("=== Syncing ERPNext Modules ===")
2025-12-13 16:03:34,801 INFO ipython # Reload Stock module
2025-12-13 16:03:34,801 INFO ipython try:
    frappe.reload_doc("erpnext", "module", "stock")
    print("‚úÖ Stock module reloaded")
except Exception as e:
    print(f"Reload failed: {e}")
2025-12-13 16:03:34,801 INFO ipython # Check all modules
2025-12-13 16:03:34,801 INFO ipython modules = frappe.get_all("Module Def", filters={"app_name": "erpnext"}, fields=["name", "app_name"])
2025-12-13 16:03:34,801 INFO ipython print(f"\nERPNext modules found: {len(modules)}")
2025-12-13 16:03:34,801 INFO ipython stock_modules = [m for m in modules if "stock" in m["name"].lower()]
2025-12-13 16:03:34,801 INFO ipython if stock_modules:
    print(f"‚úÖ Stock-related modules: {[m['name'] for m in stock_modules]}")
else:
    print("‚ùå No Stock modules found")
    print("   Available modules:", [m["name"] for m in modules[:10]])
2025-12-13 16:03:34,801 INFO ipython # Try to create Stock module if it doesn't exist
2025-12-13 16:03:34,801 INFO ipython if not frappe.db.exists("Module Def", "Stock"):
    print("\nCreating Stock module...")
    try:
        stock_module = frappe.get_doc({
            "doctype": "Module Def",
            "module_name": "Stock",
            "app_name": "erpnext"
        })
        stock_module.insert(ignore_permissions=True)
        frappe.db.commit()
        print("‚úÖ Stock module created!")
    except Exception as e:
        print(f"Error creating Stock module: {e}")
2025-12-13 16:03:34,801 INFO ipython frappe.db.close()
2025-12-13 16:03:34,801 INFO ipython === session end ===
2025-12-13 16:03:46,640 INFO ipython === bench console session ===
2025-12-13 16:03:46,641 INFO ipython import frappe
2025-12-13 16:03:46,641 INFO ipython frappe.init(site='lending.localhost')
2025-12-13 16:03:46,641 INFO ipython frappe.connect()
2025-12-13 16:03:46,641 INFO ipython print("=== Fixing Warehouse Doctype Configuration ===")
2025-12-13 16:03:46,641 INFO ipython # Get Warehouse doctype
2025-12-13 16:03:46,641 INFO ipython if frappe.db.exists("DocType", "Warehouse"):
    warehouse_dt = frappe.get_doc("DocType", "Warehouse")
    print(f"Current Warehouse doctype:")
    print(f"   Name: {warehouse_dt.name}")
    print(f"   Module: {warehouse_dt.module}")
    print(f"   App: {warehouse_dt.app_name if hasattr(warehouse_dt, 'app_name') else 'N/A'}")
    
2025-12-13 16:03:46,641 INFO ipython     # Check if module exists
2025-12-13 16:03:46,641 INFO ipython     if frappe.db.exists("Module Def", warehouse_dt.module):
        module = frappe.get_doc("Module Def", warehouse_dt.module)
        print(f"   Module Def exists: {module.name} (app: {module.app_name})")
    else:
        print(f"   ‚ùå Module Def '{warehouse_dt.module}' does not exist!")
        # Try to fix it
        if frappe.db.exists("Module Def", "Stock"):
            print("   Fixing: Setting module to 'Stock'...")
            warehouse_dt.module = "Stock"
            warehouse_dt.save(ignore_permissions=True)
            frappe.db.commit()
            print("   ‚úÖ Fixed!")
    
2025-12-13 16:03:46,641 INFO ipython     # Clear cache
2025-12-13 16:03:46,641 INFO ipython     frappe.clear_cache()
2025-12-13 16:03:46,641 INFO ipython     print("\n‚úÖ Cache cleared")
2025-12-13 16:03:46,641 INFO ipython     # Verify Warehouse can be loaded
2025-12-13 16:03:46,641 INFO ipython     try:
        from erpnext.stock.doctype.warehouse.warehouse import Warehouse
        print("‚úÖ Warehouse class can be imported")
        
        # Try to get doctype again
        warehouse_dt2 = frappe.get_doc("DocType", "Warehouse")
        print(f"‚úÖ Warehouse doctype can be loaded: {warehouse_dt2.module}")
    except Exception as e:
        print(f"‚ùå Error: {e}")
2025-12-13 16:03:46,641 INFO ipython frappe.db.close()
2025-12-13 16:03:46,641 INFO ipython === session end ===
2025-12-13 16:04:07,238 INFO ipython === bench console session ===
2025-12-13 16:04:07,238 INFO ipython import frappe
2025-12-13 16:04:07,239 INFO ipython frappe.init(site='lending.localhost')
2025-12-13 16:04:07,239 INFO ipython frappe.connect()
2025-12-13 16:04:07,239 INFO ipython print("=== Testing Company Creation with Skip Flag ===")
2025-12-13 16:04:07,239 INFO ipython # Try creating company with flag to skip warehouse creation
2025-12-13 16:04:07,239 INFO ipython try:
    # Set flag to skip chart of accounts (which includes warehouses)
    frappe.local.flags.ignore_chart_of_accounts = True
    
    company = frappe.get_doc({
        "doctype": "Company",
        "company_name": "Test Skip Warehouse",
        "abbr": "TSW",
        "default_currency": "INR",
        "country": "India"
    })
    
    company.insert(ignore_permissions=True)
    frappe.db.commit()
    
    print(f"‚úÖ SUCCESS! Company created: {company.name}")
    print(f"   This method skips warehouse creation")
    
    # Clean up test company
    frappe.delete_doc("Company", company.name, force=1)
    frappe.db.commit()
    print("   Test company deleted")
    
except Exception as e:
    print(f"‚ùå Error: {e}")
    import traceback
    traceback.print_exc()
2025-12-13 16:04:07,239 INFO ipython frappe.db.close()
2025-12-13 16:04:07,239 INFO ipython === session end ===
2025-12-13 16:04:16,896 INFO ipython === bench console session ===
2025-12-13 16:04:16,897 INFO ipython import frappe
2025-12-13 16:04:16,898 INFO ipython frappe.init(site='lending.localhost')
2025-12-13 16:04:16,898 INFO ipython frappe.connect()
2025-12-13 16:04:16,899 INFO ipython try:
    # Set flag to skip warehouse creation
    frappe.local.flags.ignore_chart_of_accounts = True
    
    company = frappe.get_doc({
        "doctype": "Company",
        "company_name": "Acme Corporation",
        "abbr": "ACME",
        "default_currency": "INR",
        "country": "India"
    })
    
    company.insert(ignore_permissions=True)
    frappe.db.commit()
    
    print(f"‚úÖ Company created: {company.name}")
    print(f"   Abbr: {company.abbr}")
    print(f"   Currency: {company.default_currency}")
    
except Exception as e:
    print(f"‚ùå Error: {e}")
    frappe.db.rollback()
2025-12-13 16:04:16,899 INFO ipython frappe.db.close()
2025-12-13 16:04:16,899 INFO ipython === session end ===
