2025-12-12 00:42:45,104 INFO ipython print(f"Monthly Repayment: {loan.monthly_repayment_amount}")
2025-12-12 00:42:45,104 INFO ipython # Create Loan Repayment
2025-12-12 00:42:45,104 INFO ipython loan_repayment = frappe.new_doc("Loan Repayment")
2025-12-12 00:42:45,104 INFO ipython loan_repayment.against_loan = loan_name
2025-12-12 00:42:45,104 INFO ipython loan_repayment.posting_date = frappe.utils.now()
2025-12-12 00:42:45,104 INFO ipython loan_repayment.value_date = frappe.utils.today()
2025-12-12 00:42:45,104 INFO ipython # Set repayment type
2025-12-12 00:42:45,104 INFO ipython loan_repayment.repayment_type = "Normal Repayment"
2025-12-12 00:42:45,104 INFO ipython # Set amount paid - using monthly repayment amount
2025-12-12 00:42:45,104 INFO ipython if loan.monthly_repayment_amount:
    loan_repayment.amount_paid = loan.monthly_repayment_amount
else:
    # If no monthly amount, use a reasonable amount (e.g., 10% of loan)
    loan_repayment.amount_paid = loan.loan_amount * 0.1
2025-12-12 00:42:45,105 INFO ipython # Set cost center if available
2025-12-12 00:42:45,105 INFO ipython if loan.cost_center:
    loan_repayment.cost_center = loan.cost_center
2025-12-12 00:42:45,105 INFO ipython # Set mode of payment (optional)
2025-12-12 00:42:45,105 INFO ipython modes = frappe.get_all("Mode of Payment", limit=1)
2025-12-12 00:42:45,105 INFO ipython if modes:
    loan_repayment.mode_of_payment = modes[0].name
2025-12-12 00:42:45,105 INFO ipython # Reference information
2025-12-12 00:42:45,105 INFO ipython loan_repayment.reference_date = frappe.utils.today()
2025-12-12 00:42:45,105 INFO ipython loan_repayment.reference_number = f"REP-{loan.name}-001"
2025-12-12 00:42:45,105 INFO ipython # Manual remarks
2025-12-12 00:42:45,105 INFO ipython loan_repayment.manual_remarks = "First monthly repayment installment"
2025-12-12 00:42:45,105 INFO ipython try:
    loan_repayment.insert(ignore_permissions=True)
    print(f"\n‚úÖ Created Loan Repayment: {loan_repayment.name}")
    print(f"   Against Loan: {loan_repayment.against_loan}")
    print(f"   Posting Date: {loan_repayment.posting_date}")
    print(f"   Value Date: {loan_repayment.value_date}")
    print(f"   Amount Paid: {loan_repayment.amount_paid}")
    print(f"   Repayment Type: {loan_repayment.repayment_type}")
    print(f"   Company: {loan_repayment.company}")
    print(f"   Applicant: {loan_repayment.applicant}")
    print(f"   Reference Number: {loan_repayment.reference_number}")
    print(f"   Status: {loan_repayment.status}")
    print(f"   URL: /app/loan-repayment/{loan_repayment.name}")
    frappe.db.commit()
except Exception as e:
    print(f"‚ùå Error creating loan repayment: {e}")
    import traceback
    traceback.print_exc()
2025-12-12 00:42:45,105 INFO ipython frappe.db.close()
2025-12-12 00:42:45,105 INFO ipython === session end ===
2025-12-12 00:42:54,669 INFO ipython === bench console session ===
2025-12-12 00:42:54,669 INFO ipython import frappe
2025-12-12 00:42:54,669 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:42:54,669 INFO ipython frappe.connect()
2025-12-12 00:42:54,669 INFO ipython # Check Company settings
2025-12-12 00:42:54,669 INFO ipython company = frappe.get_doc("Company", "My Lending Co")
2025-12-12 00:42:54,669 INFO ipython print(f"Company: {company.name}")
2025-12-12 00:42:54,669 INFO ipython print(f"Collection Offset Sequence: {company.get('collection_offset_sequence_for_standard_asset', 'Not set')}")
2025-12-12 00:42:54,669 INFO ipython # Check Loan Product settings
2025-12-12 00:42:54,669 INFO ipython loan_product = frappe.get_doc("Loan Product", "LP-001")
2025-12-12 00:42:54,669 INFO ipython print(f"\nLoan Product: {loan_product.name}")
2025-12-12 00:42:54,669 INFO ipython print(f"Collection Offset Sequence: {loan_product.get('collection_offset_sequence_for_standard_asset', 'Not set')}")
2025-12-12 00:42:54,669 INFO ipython # Check if Collection Offset Sequence doctype exists
2025-12-12 00:42:54,669 INFO ipython if frappe.db.exists("DocType", "Collection Offset Sequence"):
    sequences = frappe.get_all("Collection Offset Sequence", limit=5)
    print(f"\nAvailable Collection Offset Sequences: {len(sequences)}")
    if sequences:
        for seq in sequences:
            print(f"  - {seq.name}")
    else:
        print("  No sequences found - need to create one")
else:
    print("\nCollection Offset Sequence doctype does not exist")
2025-12-12 00:42:54,669 INFO ipython frappe.db.close()
2025-12-12 00:42:54,669 INFO ipython === session end ===
2025-12-12 00:43:10,083 INFO ipython === bench console session ===
2025-12-12 00:43:10,084 INFO ipython import frappe
2025-12-12 00:43:10,084 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:43:10,084 INFO ipython frappe.connect()
2025-12-12 00:43:10,084 INFO ipython # Check if Loan Demand Offset Order exists
2025-12-12 00:43:10,084 INFO ipython if frappe.db.exists("DocType", "Loan Demand Offset Order"):
    orders = frappe.get_all("Loan Demand Offset Order", limit=5)
    print(f"Existing Loan Demand Offset Orders: {len(orders)}")
    if orders:
        order_name = orders[0].name
        print(f"Using existing: {order_name}")
    else:
        # Create one
        order = frappe.new_doc("Loan Demand Offset Order")
        order.title = "Standard Loan Demand Offset Order"
        order.append("components", {"demand_type": "Penalty"})
        order.append("components", {"demand_type": "Interest"})
        order.append("components", {"demand_type": "Principal"})
        order.insert(ignore_permissions=True)
        order_name = order.name
        frappe.db.commit()
        print(f"Created: {order_name}")
    
2025-12-12 00:43:10,084 INFO ipython     # Set in Company
2025-12-12 00:43:10,084 INFO ipython     company = frappe.get_doc("Company", "My Lending Co")
2025-12-12 00:43:10,084 INFO ipython     if not company.get("collection_offset_sequence_for_standard_asset"):
        company.collection_offset_sequence_for_standard_asset = order_name
        company.save(ignore_permissions=True)
        frappe.db.commit()
        print(f"‚úÖ Set Collection Offset Sequence in Company")
    else:
        print(f"‚úÖ Company already has Collection Offset Sequence set")
else:
    print("‚ùå Loan Demand Offset Order doctype does not exist")
2025-12-12 00:43:10,084 INFO ipython frappe.db.close()
2025-12-12 00:43:10,084 INFO ipython === session end ===
2025-12-12 00:43:19,171 INFO ipython === bench console session ===
2025-12-12 00:43:19,172 INFO ipython import frappe
2025-12-12 00:43:19,172 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:43:19,172 INFO ipython frappe.connect()
2025-12-12 00:43:19,172 INFO ipython # Get or create Loan Demand Offset Order
2025-12-12 00:43:19,172 INFO ipython orders = frappe.get_all("Loan Demand Offset Order", limit=1)
2025-12-12 00:43:19,172 INFO ipython if orders:
    order_name = orders[0].name
    print(f"Using existing order: {order_name}")
else:
    order = frappe.new_doc("Loan Demand Offset Order")
    order.title = "Standard Loan Demand Offset Order"
    order.append("components", {"demand_type": "Penalty"})
    order.append("components", {"demand_type": "Interest"})
    order.append("components", {"demand_type": "Principal"})
    order.insert(ignore_permissions=True)
    order_name = order.name
    frappe.db.commit()
    print(f"Created order: {order_name}")
2025-12-12 00:43:19,172 INFO ipython # Set in Company
2025-12-12 00:43:19,172 INFO ipython company = frappe.get_doc("Company", "My Lending Co")
2025-12-12 00:43:19,172 INFO ipython if not company.get("collection_offset_sequence_for_standard_asset"):
    company.collection_offset_sequence_for_standard_asset = order_name
    company.save(ignore_permissions=True)
    frappe.db.commit()
    print(f"‚úÖ Set Collection Offset Sequence in Company: {order_name}")
else:
    print(f"‚úÖ Company already has Collection Offset Sequence: {company.collection_offset_sequence_for_standard_asset}")
2025-12-12 00:43:19,172 INFO ipython frappe.db.close()
2025-12-12 00:43:19,172 INFO ipython === session end ===
2025-12-12 00:43:20,391 INFO ipython === bench console session ===
2025-12-12 00:43:20,391 INFO ipython import frappe
2025-12-12 00:43:20,391 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:43:20,391 INFO ipython frappe.connect()
2025-12-12 00:43:20,391 INFO ipython loan_name = "ACC-LOAN-2025-00001"
2025-12-12 00:43:20,391 INFO ipython # Get loan details
2025-12-12 00:43:20,391 INFO ipython loan = frappe.get_doc("Loan", loan_name)
2025-12-12 00:43:20,391 INFO ipython print(f"Using Loan: {loan.name}")
2025-12-12 00:43:20,391 INFO ipython print(f"Loan Amount: {loan.loan_amount}")
2025-12-12 00:43:20,391 INFO ipython print(f"Monthly Repayment: {loan.monthly_repayment_amount}")
2025-12-12 00:43:20,391 INFO ipython # Create Loan Repayment
2025-12-12 00:43:20,391 INFO ipython loan_repayment = frappe.new_doc("Loan Repayment")
2025-12-12 00:43:20,391 INFO ipython loan_repayment.against_loan = loan_name
2025-12-12 00:43:20,391 INFO ipython loan_repayment.posting_date = frappe.utils.now()
2025-12-12 00:43:20,391 INFO ipython loan_repayment.value_date = frappe.utils.today()
2025-12-12 00:43:20,391 INFO ipython # Set repayment type
2025-12-12 00:43:20,391 INFO ipython loan_repayment.repayment_type = "Normal Repayment"
2025-12-12 00:43:20,391 INFO ipython # Set amount paid - using monthly repayment amount
2025-12-12 00:43:20,391 INFO ipython if loan.monthly_repayment_amount:
    loan_repayment.amount_paid = loan.monthly_repayment_amount
else:
    # If no monthly amount, use a reasonable amount (e.g., 10% of loan)
    loan_repayment.amount_paid = loan.loan_amount * 0.1
2025-12-12 00:43:20,391 INFO ipython # Set cost center if available
2025-12-12 00:43:20,391 INFO ipython if loan.cost_center:
    loan_repayment.cost_center = loan.cost_center
2025-12-12 00:43:20,391 INFO ipython # Set mode of payment (optional)
2025-12-12 00:43:20,391 INFO ipython modes = frappe.get_all("Mode of Payment", limit=1)
2025-12-12 00:43:20,391 INFO ipython if modes:
    loan_repayment.mode_of_payment = modes[0].name
2025-12-12 00:43:20,391 INFO ipython # Reference information
2025-12-12 00:43:20,391 INFO ipython loan_repayment.reference_date = frappe.utils.today()
2025-12-12 00:43:20,391 INFO ipython loan_repayment.reference_number = f"REP-{loan.name}-001"
2025-12-12 00:43:20,391 INFO ipython # Manual remarks
2025-12-12 00:43:20,391 INFO ipython loan_repayment.manual_remarks = "First monthly repayment installment"
2025-12-12 00:43:20,391 INFO ipython try:
    loan_repayment.insert(ignore_permissions=True)
    print(f"\n‚úÖ Created Loan Repayment: {loan_repayment.name}")
    print(f"   Against Loan: {loan_repayment.against_loan}")
    print(f"   Posting Date: {loan_repayment.posting_date}")
    print(f"   Value Date: {loan_repayment.value_date}")
    print(f"   Amount Paid: {loan_repayment.amount_paid}")
    print(f"   Repayment Type: {loan_repayment.repayment_type}")
    print(f"   Company: {loan_repayment.company}")
    print(f"   Applicant: {loan_repayment.applicant}")
    print(f"   Reference Number: {loan_repayment.reference_number}")
    print(f"   Status: {loan_repayment.status}")
    print(f"   URL: /app/loan-repayment/{loan_repayment.name}")
    frappe.db.commit()
except Exception as e:
    print(f"‚ùå Error creating loan repayment: {e}")
    import traceback
    traceback.print_exc()
2025-12-12 00:43:20,391 INFO ipython frappe.db.close()
2025-12-12 00:43:20,391 INFO ipython === session end ===
2025-12-12 00:43:28,343 INFO ipython === bench console session ===
2025-12-12 00:43:28,343 INFO ipython import frappe
2025-12-12 00:43:28,343 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:43:28,343 INFO ipython frappe.connect()
2025-12-12 00:43:28,343 INFO ipython # Get order
2025-12-12 00:43:28,343 INFO ipython order = frappe.get_doc("Loan Demand Offset Order", "Standard Loan Demand Offset Order")
2025-12-12 00:43:28,343 INFO ipython print(f"Order: {order.name}")
2025-12-12 00:43:28,343 INFO ipython # Set directly in Company using db.set_value to bypass validation
2025-12-12 00:43:28,343 INFO ipython frappe.db.set_value("Company", "My Lending Co", "collection_offset_sequence_for_standard_asset", order.name)
2025-12-12 00:43:28,343 INFO ipython frappe.db.commit()
2025-12-12 00:43:28,343 INFO ipython print(f"‚úÖ Set Collection Offset Sequence in Company using db.set_value")
2025-12-12 00:43:28,343 INFO ipython # Verify
2025-12-12 00:43:28,344 INFO ipython company = frappe.get_doc("Company", "My Lending Co")
2025-12-12 00:43:28,344 INFO ipython print(f"Verified: {company.collection_offset_sequence_for_standard_asset}")
2025-12-12 00:43:28,344 INFO ipython frappe.db.close()
2025-12-12 00:43:28,344 INFO ipython === session end ===
2025-12-12 00:43:29,470 INFO ipython === bench console session ===
2025-12-12 00:43:29,470 INFO ipython import frappe
2025-12-12 00:43:29,470 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:43:29,470 INFO ipython frappe.connect()
2025-12-12 00:43:29,470 INFO ipython loan_name = "ACC-LOAN-2025-00001"
2025-12-12 00:43:29,470 INFO ipython # Get loan details
2025-12-12 00:43:29,470 INFO ipython loan = frappe.get_doc("Loan", loan_name)
2025-12-12 00:43:29,470 INFO ipython print(f"Using Loan: {loan.name}")
2025-12-12 00:43:29,470 INFO ipython print(f"Loan Amount: {loan.loan_amount}")
2025-12-12 00:43:29,470 INFO ipython print(f"Monthly Repayment: {loan.monthly_repayment_amount}")
2025-12-12 00:43:29,470 INFO ipython # Create Loan Repayment
2025-12-12 00:43:29,470 INFO ipython loan_repayment = frappe.new_doc("Loan Repayment")
2025-12-12 00:43:29,470 INFO ipython loan_repayment.against_loan = loan_name
2025-12-12 00:43:29,470 INFO ipython loan_repayment.posting_date = frappe.utils.now()
2025-12-12 00:43:29,471 INFO ipython loan_repayment.value_date = frappe.utils.today()
2025-12-12 00:43:29,471 INFO ipython # Set repayment type
2025-12-12 00:43:29,471 INFO ipython loan_repayment.repayment_type = "Normal Repayment"
2025-12-12 00:43:29,471 INFO ipython # Set amount paid - using monthly repayment amount
2025-12-12 00:43:29,471 INFO ipython if loan.monthly_repayment_amount:
    loan_repayment.amount_paid = loan.monthly_repayment_amount
else:
    # If no monthly amount, use a reasonable amount (e.g., 10% of loan)
    loan_repayment.amount_paid = loan.loan_amount * 0.1
2025-12-12 00:43:29,471 INFO ipython # Set cost center if available
2025-12-12 00:43:29,471 INFO ipython if loan.cost_center:
    loan_repayment.cost_center = loan.cost_center
2025-12-12 00:43:29,471 INFO ipython # Set mode of payment (optional)
2025-12-12 00:43:29,471 INFO ipython modes = frappe.get_all("Mode of Payment", limit=1)
2025-12-12 00:43:29,471 INFO ipython if modes:
    loan_repayment.mode_of_payment = modes[0].name
2025-12-12 00:43:29,471 INFO ipython # Reference information
2025-12-12 00:43:29,471 INFO ipython loan_repayment.reference_date = frappe.utils.today()
2025-12-12 00:43:29,471 INFO ipython loan_repayment.reference_number = f"REP-{loan.name}-001"
2025-12-12 00:43:29,471 INFO ipython # Manual remarks
2025-12-12 00:43:29,471 INFO ipython loan_repayment.manual_remarks = "First monthly repayment installment"
2025-12-12 00:43:29,471 INFO ipython try:
    loan_repayment.insert(ignore_permissions=True)
    print(f"\n‚úÖ Created Loan Repayment: {loan_repayment.name}")
    print(f"   Against Loan: {loan_repayment.against_loan}")
    print(f"   Posting Date: {loan_repayment.posting_date}")
    print(f"   Value Date: {loan_repayment.value_date}")
    print(f"   Amount Paid: {loan_repayment.amount_paid}")
    print(f"   Repayment Type: {loan_repayment.repayment_type}")
    print(f"   Company: {loan_repayment.company}")
    print(f"   Applicant: {loan_repayment.applicant}")
    print(f"   Reference Number: {loan_repayment.reference_number}")
    print(f"   Status: {loan_repayment.status}")
    print(f"   URL: /app/loan-repayment/{loan_repayment.name}")
    frappe.db.commit()
except Exception as e:
    print(f"‚ùå Error creating loan repayment: {e}")
    import traceback
    traceback.print_exc()
2025-12-12 00:43:29,471 INFO ipython frappe.db.close()
2025-12-12 00:43:29,471 INFO ipython === session end ===
2025-12-12 00:43:40,148 INFO ipython === bench console session ===
2025-12-12 00:43:40,149 INFO ipython import frappe
2025-12-12 00:43:40,149 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:43:40,149 INFO ipython frappe.connect()
2025-12-12 00:43:40,149 INFO ipython loan_repayment = frappe.get_doc("Loan Repayment", "LM-REP-0001")
2025-12-12 00:43:40,149 INFO ipython print(f"\n‚úÖ Loan Repayment Details:")
2025-12-12 00:43:40,149 INFO ipython print(f"   Name: {loan_repayment.name}")
2025-12-12 00:43:40,149 INFO ipython print(f"   Against Loan: {loan_repayment.against_loan}")
2025-12-12 00:43:40,149 INFO ipython print(f"   Company: {loan_repayment.company}")
2025-12-12 00:43:40,149 INFO ipython print(f"   Applicant: {loan_repayment.applicant} ({loan_repayment.applicant_type})")
2025-12-12 00:43:40,149 INFO ipython print(f"   Posting Date: {loan_repayment.posting_date}")
2025-12-12 00:43:40,149 INFO ipython print(f"   Value Date: {loan_repayment.value_date}")
2025-12-12 00:43:40,149 INFO ipython print(f"   Amount Paid: {loan_repayment.amount_paid}")
2025-12-12 00:43:40,149 INFO ipython print(f"   Repayment Type: {loan_repayment.repayment_type}")
2025-12-12 00:43:40,150 INFO ipython print(f"   Interest Payable: {loan_repayment.interest_payable}")
2025-12-12 00:43:40,150 INFO ipython print(f"   Payable Amount: {loan_repayment.payable_amount}")
2025-12-12 00:43:40,150 INFO ipython print(f"   Pending Principal Amount: {loan_repayment.pending_principal_amount}")
2025-12-12 00:43:40,150 INFO ipython print(f"   Reference Number: {loan_repayment.reference_number}")
2025-12-12 00:43:40,150 INFO ipython print(f"   Reference Date: {loan_repayment.reference_date}")
2025-12-12 00:43:40,150 INFO ipython print(f"   Manual Remarks: {loan_repayment.manual_remarks}")
2025-12-12 00:43:40,150 INFO ipython if loan_repayment.cost_center:
    print(f"   Cost Center: {loan_repayment.cost_center}")
if loan_repayment.mode_of_payment:
    print(f"   Mode of Payment: {loan_repayment.mode_of_payment}")
print(f"\n   Access URL: http://lending.localhost:8000/app/loan-repayment/{loan_repayment.name}")
2025-12-12 00:43:40,150 INFO ipython frappe.db.close()
2025-12-12 00:43:40,150 INFO ipython === session end ===
2025-12-12 00:43:56,204 INFO ipython === bench console session ===
2025-12-12 00:43:56,205 INFO ipython import frappe
2025-12-12 00:43:56,205 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:43:56,205 INFO ipython frappe.connect()
2025-12-12 00:43:56,205 INFO ipython # Find the repayment
2025-12-12 00:43:56,205 INFO ipython repayments = frappe.get_all("Loan Repayment", 
    filters={"against_loan": "ACC-LOAN-2025-00001"},
    fields=["name", "amount_paid", "posting_date"],
    limit=5
)
2025-12-12 00:43:56,205 INFO ipython print(f"Loan Repayments found: {len(repayments)}")
2025-12-12 00:43:56,205 INFO ipython for r in repayments:
    print(f"  - {r.name}: {r.amount_paid} on {r.posting_date}")
2025-12-12 00:43:56,205 INFO ipython if repayments:
    loan_repayment = frappe.get_doc("Loan Repayment", repayments[0].name)
    print(f"\n‚úÖ Loan Repayment Details:")
    print(f"   Name: {loan_repayment.name}")
    print(f"   Against Loan: {loan_repayment.against_loan}")
    print(f"   Company: {loan_repayment.company}")
    print(f"   Applicant: {loan_repayment.applicant} ({loan_repayment.applicant_type})")
    print(f"   Posting Date: {loan_repayment.posting_date}")
    print(f"   Value Date: {loan_repayment.value_date}")
    print(f"   Amount Paid: {loan_repayment.amount_paid}")
    print(f"   Repayment Type: {loan_repayment.repayment_type}")
    print(f"   Interest Payable: {loan_repayment.interest_payable}")
    print(f"   Payable Amount: {loan_repayment.payable_amount}")
    print(f"   Pending Principal Amount: {loan_repayment.pending_principal_amount}")
    print(f"   Reference Number: {loan_repayment.reference_number}")
    print(f"   Reference Date: {loan_repayment.reference_date}")
    print(f"   Manual Remarks: {loan_repayment.manual_remarks}")
    if loan_repayment.cost_center:
        print(f"   Cost Center: {loan_repayment.cost_center}")
    if loan_repayment.mode_of_payment:
        print(f"   Mode of Payment: {loan_repayment.mode_of_payment}")
    print(f"\n   Access URL: http://lending.localhost:8000/app/loan-repayment/{loan_repayment.name}")
2025-12-12 00:43:56,205 INFO ipython frappe.db.close()
2025-12-12 00:43:56,205 INFO ipython === session end ===
2025-12-12 00:44:07,484 INFO ipython === bench console session ===
2025-12-12 00:44:07,484 INFO ipython import frappe
2025-12-12 00:44:07,484 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:44:07,484 INFO ipython frappe.connect()
2025-12-12 00:44:07,484 INFO ipython loan_name = "ACC-LOAN-2025-00001"
2025-12-12 00:44:07,485 INFO ipython loan = frappe.get_doc("Loan", loan_name)
2025-12-12 00:44:07,485 INFO ipython # Create Loan Repayment with minimal required fields
2025-12-12 00:44:07,485 INFO ipython loan_repayment = frappe.new_doc("Loan Repayment")
2025-12-12 00:44:07,485 INFO ipython loan_repayment.against_loan = loan_name
2025-12-12 00:44:07,485 INFO ipython loan_repayment.posting_date = frappe.utils.now()
2025-12-12 00:44:07,485 INFO ipython loan_repayment.value_date = frappe.utils.today()
2025-12-12 00:44:07,485 INFO ipython loan_repayment.repayment_type = "Normal Repayment"
2025-12-12 00:44:07,485 INFO ipython loan_repayment.amount_paid = 8885.0  # Monthly repayment amount
2025-12-12 00:44:07,485 INFO ipython loan_repayment.reference_number = "REP-001"
2025-12-12 00:44:07,485 INFO ipython loan_repayment.reference_date = frappe.utils.today()
2025-12-12 00:44:07,485 INFO ipython loan_repayment.manual_remarks = "First monthly repayment installment"
2025-12-12 00:44:07,485 INFO ipython try:
    loan_repayment.insert(ignore_permissions=True)
    print(f"‚úÖ Created Loan Repayment: {loan_repayment.name}")
    print(f"   Against Loan: {loan_repayment.against_loan}")
    print(f"   Amount Paid: {loan_repayment.amount_paid}")
    print(f"   Posting Date: {loan_repayment.posting_date}")
    frappe.db.commit()
except Exception as e:
    print(f"‚ùå Error: {e}")
    import traceback
    traceback.print_exc()
2025-12-12 00:44:07,485 INFO ipython frappe.db.close()
2025-12-12 00:44:07,485 INFO ipython === session end ===
2025-12-12 00:44:17,839 INFO ipython === bench console session ===
2025-12-12 00:44:17,839 INFO ipython import frappe
2025-12-12 00:44:17,839 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:44:17,839 INFO ipython frappe.connect()
2025-12-12 00:44:17,839 INFO ipython loan_repayment = frappe.get_doc("Loan Repayment", "LM-REP-0001")
2025-12-12 00:44:17,840 INFO ipython print(f"\n‚úÖ Loan Repayment Details:")
2025-12-12 00:44:17,840 INFO ipython print(f"   Name: {loan_repayment.name}")
2025-12-12 00:44:17,840 INFO ipython print(f"   Against Loan: {loan_repayment.against_loan}")
2025-12-12 00:44:17,840 INFO ipython print(f"   Company: {loan_repayment.company}")
2025-12-12 00:44:17,840 INFO ipython print(f"   Applicant: {loan_repayment.applicant} ({loan_repayment.applicant_type})")
2025-12-12 00:44:17,840 INFO ipython print(f"   Posting Date: {loan_repayment.posting_date}")
2025-12-12 00:44:17,840 INFO ipython print(f"   Value Date: {loan_repayment.value_date}")
2025-12-12 00:44:17,840 INFO ipython print(f"   Amount Paid: {loan_repayment.amount_paid}")
2025-12-12 00:44:17,840 INFO ipython print(f"   Repayment Type: {loan_repayment.repayment_type}")
2025-12-12 00:44:17,840 INFO ipython print(f"   Interest Payable: {loan_repayment.interest_payable}")
2025-12-12 00:44:17,840 INFO ipython print(f"   Payable Amount: {loan_repayment.payable_amount}")
2025-12-12 00:44:17,840 INFO ipython print(f"   Pending Principal Amount: {loan_repayment.pending_principal_amount}")
2025-12-12 00:44:17,840 INFO ipython print(f"   Reference Number: {loan_repayment.reference_number}")
2025-12-12 00:44:17,840 INFO ipython print(f"   Reference Date: {loan_repayment.reference_date}")
2025-12-12 00:44:17,840 INFO ipython print(f"   Manual Remarks: {loan_repayment.manual_remarks}")
2025-12-12 00:44:17,840 INFO ipython if loan_repayment.cost_center:
    print(f"   Cost Center: {loan_repayment.cost_center}")
if loan_repayment.mode_of_payment:
    print(f"   Mode of Payment: {loan_repayment.mode_of_payment}")
print(f"\n   Access URL: http://lending.localhost:8000/app/loan-repayment/{loan_repayment.name}")
2025-12-12 00:44:17,840 INFO ipython frappe.db.close()
2025-12-12 00:44:17,840 INFO ipython === session end ===
2025-12-12 01:02:40,556 INFO ipython === bench console session ===
2025-12-12 01:02:40,556 INFO ipython import frappe
2025-12-12 01:02:40,556 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 01:02:40,556 INFO ipython frappe.connect()
2025-12-12 01:02:40,556 INFO ipython # Check the New Loans chart
2025-12-12 01:02:40,556 INFO ipython chart = frappe.get_doc("Dashboard Chart", "New Loans")
2025-12-12 01:02:40,556 INFO ipython print(f"Chart: {chart.name}")
2025-12-12 01:02:40,556 INFO ipython print(f"Chart Type: {chart.chart_type}")
2025-12-12 01:02:40,557 INFO ipython print(f"Based On: {chart.based_on}")
2025-12-12 01:02:40,557 INFO ipython print(f"Document Type: {chart.document_type}")
2025-12-12 01:02:40,557 INFO ipython print(f"Filters: {chart.filters}")
2025-12-12 01:02:40,557 INFO ipython print(f"JSON: {chart.filters_json}")
2025-12-12 01:02:40,557 INFO ipython frappe.db.close()
2025-12-12 01:02:40,557 INFO ipython === session end ===
2025-12-12 01:03:04,157 INFO ipython === bench console session ===
2025-12-12 01:03:04,158 INFO ipython import frappe
2025-12-12 01:03:04,158 INFO ipython import json
2025-12-12 01:03:04,158 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 01:03:04,158 INFO ipython frappe.connect()
2025-12-12 01:03:04,158 INFO ipython # Fix the New Loans chart filter
2025-12-12 01:03:04,158 INFO ipython chart = frappe.get_doc("Dashboard Chart", "New Loans")
2025-12-12 01:03:04,158 INFO ipython print(f"Current filters_json: {chart.filters_json}")
2025-12-12 01:03:04,158 INFO ipython # The issue is the format: [["Loan","docstatus","=","1",false]]
2025-12-12 01:03:04,158 INFO ipython # Should be: [["Loan","docstatus","=","1"]]
2025-12-12 01:03:04,158 INFO ipython # Remove the 5th element (false)
2025-12-12 01:03:04,158 INFO ipython try:
    filters = json.loads(chart.filters_json)
    print(f"Parsed filters: {filters}")
    
    # Fix the filter format - remove the 5th element if present
    fixed_filters = []
    for filter_item in filters:
        if len(filter_item) > 4:
            # Remove the 5th element (legacy format)
            fixed_filter = filter_item[:4]
            fixed_filters.append(fixed_filter)
            print(f"Fixed filter: {filter_item} -> {fixed_filter}")
        else:
            fixed_filters.append(filter_item)
    
    chart.filters_json = json.dumps(fixed_filters)
    chart.save(ignore_permissions=True)
    frappe.db.commit()
    print(f"\n‚úÖ Fixed New Loans chart filters")
    print(f"New filters_json: {chart.filters_json}")
except Exception as e:
    print(f"‚ùå Error: {e}")
    import traceback
    traceback.print_exc()
2025-12-12 01:03:04,158 INFO ipython frappe.db.close()
2025-12-12 01:03:04,158 INFO ipython === session end ===
2025-12-12 01:03:19,806 INFO ipython === bench console session ===
2025-12-12 01:03:19,806 INFO ipython import frappe
2025-12-12 01:03:19,806 INFO ipython import json
2025-12-12 01:03:19,806 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 01:03:19,806 INFO ipython frappe.connect()
2025-12-12 01:03:19,806 INFO ipython # Fix all dashboard charts with the incorrect filter format
2025-12-12 01:03:19,807 INFO ipython charts_to_fix = ["New Loans", "Loan Disbursements", "Loan Interest Accrual"]
2025-12-12 01:03:19,807 INFO ipython for chart_name in charts_to_fix:
    try:
        chart = frappe.get_doc("Dashboard Chart", chart_name)
        print(f"\nChecking: {chart_name}")
        print(f"Current filters_json: {chart.filters_json}")
        
        filters = json.loads(chart.filters_json)
        fixed_filters = []
        needs_fix = False
        
        for filter_item in filters:
            if len(filter_item) > 4:
                # Remove the 5th element (legacy format)
                fixed_filter = filter_item[:4]
                fixed_filters.append(fixed_filter)
                needs_fix = True
                print(f"  Fixed: {filter_item} -> {fixed_filter}")
            else:
                fixed_filters.append(filter_item)
        
        if needs_fix:
            # Use db.set_value to bypass validation
            frappe.db.set_value("Dashboard Chart", chart_name, "filters_json", json.dumps(fixed_filters))
            print(f"  ‚úÖ Fixed {chart_name}")
        else:
            print(f"  ‚úÖ {chart_name} is already correct")
    except Exception as e:
        print(f"  ‚ùå Error fixing {chart_name}: {e}")
2025-12-12 01:03:19,807 INFO ipython frappe.db.commit()
2025-12-12 01:03:19,807 INFO ipython print("\n‚úÖ All charts fixed!")
2025-12-12 01:03:19,807 INFO ipython frappe.db.close()
2025-12-12 01:03:19,807 INFO ipython === session end ===
2025-12-12 01:03:42,131 INFO ipython === bench console session ===
2025-12-12 01:03:42,132 INFO ipython import frappe
2025-12-12 01:03:42,132 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 01:03:42,132 INFO ipython frappe.connect()
2025-12-12 01:03:42,132 INFO ipython # Test the chart now
2025-12-12 01:03:42,132 INFO ipython print("Testing New Loans chart...")
2025-12-12 01:03:42,132 INFO ipython try:
    chart = frappe.get_doc("Dashboard Chart", "New Loans")
    print(f"Chart: {chart.name}")
    print(f"Filters JSON: {chart.filters_json}")
    
    # Try to get the chart data
    from frappe.desk.doctype.dashboard_chart.dashboard_chart import get
    result = get(chart_name="New Loans", refresh=1)
    print(f"\n‚úÖ Chart loaded successfully!")
    print(f"Chart data available: {bool(result)}")
except Exception as e:
    print(f"‚ùå Error: {e}")
    import traceback
    traceback.print_exc()
2025-12-12 01:03:42,132 INFO ipython frappe.db.close()
2025-12-12 01:03:42,132 INFO ipython === session end ===
2025-12-12 01:05:05,045 INFO ipython === bench console session ===
2025-12-12 01:05:05,046 INFO ipython import frappe
2025-12-12 01:05:05,046 INFO ipython import json
2025-12-12 01:05:05,046 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 01:05:05,046 INFO ipython frappe.connect()
2025-12-12 01:05:05,046 INFO ipython # Check and fix number cards with the same issue
2025-12-12 01:05:05,046 INFO ipython number_cards = frappe.get_all("Number Card", filters={"is_standard": 1}, fields=["name", "filters_json"])
2025-12-12 01:05:05,046 INFO ipython print("Checking Number Cards for filter format issues...")
2025-12-12 01:05:05,046 INFO ipython print("-" * 70)
2025-12-12 01:05:05,046 INFO ipython fixed_count = 0
2025-12-12 01:05:05,046 INFO ipython for card in number_cards:
    try:
        filters = json.loads(card.filters_json or "[]")
        needs_fix = False
        fixed_filters = []
        
        for filter_item in filters:
            if len(filter_item) > 4:
                fixed_filter = filter_item[:4]
                fixed_filters.append(fixed_filter)
                needs_fix = True
            else:
                fixed_filters.append(filter_item)
        
        if needs_fix:
            frappe.db.set_value("Number Card", card.name, "filters_json", json.dumps(fixed_filters))
            print(f"‚úÖ Fixed: {card.name}")
            fixed_count += 1
    except Exception as e:
        print(f"‚ö†Ô∏è  Skipped {card.name}: {e}")
2025-12-12 01:05:05,046 INFO ipython if fixed_count > 0:
    frappe.db.commit()
    print(f"\n‚úÖ Fixed {fixed_count} number card(s)")
else:
    print("\n‚úÖ All number cards are correct")
2025-12-12 01:05:05,046 INFO ipython frappe.db.close()
2025-12-12 01:05:05,046 INFO ipython === session end ===
2025-12-12 01:05:21,488 INFO ipython === bench console session ===
2025-12-12 01:05:21,489 INFO ipython import frappe
2025-12-12 01:05:21,489 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 01:05:21,489 INFO ipython frappe.connect()
2025-12-12 01:05:21,489 INFO ipython print("="*70)
2025-12-12 01:05:21,489 INFO ipython print("VERIFICATION: Testing Dashboard Charts")
2025-12-12 01:05:21,489 INFO ipython print("="*70)
2025-12-12 01:05:21,489 INFO ipython charts_to_test = ["New Loans", "Loan Disbursements", "Loan Interest Accrual"]
2025-12-12 01:05:21,489 INFO ipython for chart_name in charts_to_test:
    try:
        chart = frappe.get_doc("Dashboard Chart", chart_name)
        print(f"\n‚úÖ {chart_name}:")
        print(f"   Filters: {chart.filters_json}")
        
        # Test chart loading
        from frappe.desk.doctype.dashboard_chart.dashboard_chart import get
        result = get(chart_name=chart_name, refresh=1)
        print(f"   Status: Working ‚úì")
    except Exception as e:
        print(f"\n‚ùå {chart_name}: Error - {e}")
2025-12-12 01:05:21,489 INFO ipython print("\n" + "="*70)
2025-12-12 01:05:21,489 INFO ipython print("‚úÖ All dashboard charts fixed and working!")
2025-12-12 01:05:21,489 INFO ipython print("="*70)
2025-12-12 01:05:21,489 INFO ipython print("\nüí° The error should be resolved now.")
2025-12-12 01:05:21,489 INFO ipython print("   Refresh your browser and check: http://lending.localhost:8000/desk/lending")
2025-12-12 01:05:21,489 INFO ipython frappe.db.close()
2025-12-12 01:05:21,489 INFO ipython === session end ===
2025-12-12 01:08:20,409 INFO ipython === bench console session ===
2025-12-12 01:08:20,409 INFO ipython import frappe
2025-12-12 01:08:20,409 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 01:08:20,409 INFO ipython frappe.connect()
2025-12-12 01:08:20,409 INFO ipython print("="*70)
2025-12-12 01:08:20,409 INFO ipython print("COMPREHENSIVE LENDING ROUTES CHECK")
2025-12-12 01:08:20,409 INFO ipython print("="*70)
2025-12-12 01:08:20,410 INFO ipython errors = []
2025-12-12 01:08:20,410 INFO ipython warnings = []
2025-12-12 01:08:20,410 INFO ipython success = []
2025-12-12 01:08:20,410 INFO ipython # 1. Check Core Lending Doctypes
2025-12-12 01:08:20,410 INFO ipython print("\n1. CHECKING CORE LENDING DOCTYPES")
2025-12-12 01:08:20,410 INFO ipython print("-" * 70)
2025-12-12 01:08:20,410 INFO ipython lending_doctypes = [
    "Loan Application", "Loan Product", "Loan", "Loan Restructure",
    "Loan Disbursement", "Loan Repayment", "Loan Security", 
    "Loan Security Assignment", "Loan Security Pledge", 
    "Loan Interest Accrual", "Loan Demand", "Loan Write Off",
    "Loan Balance Adjustment", "Loan Refund", "Loan Transfer",
    "Loan Classification", "Loan Security Deposit", 
    "Loan Repayment Schedule", "Loan Security Type", "Loan Security Price",
    "Loan Security Release", "Loan Security Shortfall", "Loan Category"
]
2025-12-12 01:08:20,410 INFO ipython for doctype in lending_doctypes:
    try:
        if frappe.db.exists("DocType", doctype):
            # Check if we can get list
            records = frappe.get_all(doctype, limit=1)
            route = f"/app/{doctype.lower().replace(' ', '-')}"
            success.append(f"‚úÖ {doctype}: Route {route} - {len(records)} records")
        else:
            errors.append(f"‚ùå {doctype}: DocType does not exist")
    except Exception as e:
        errors.append(f"‚ùå {doctype}: Error - {str(e)[:100]}")
2025-12-12 01:08:20,410 INFO ipython # 2. Check Workspaces
2025-12-12 01:08:20,410 INFO ipython print("\n2. CHECKING WORKSPACES")
2025-12-12 01:08:20,410 INFO ipython print("-" * 70)
2025-12-12 01:08:20,410 INFO ipython workspaces = ["Lending", "Loan Origination", "Applications", "Loans"]
2025-12-12 01:08:20,410 INFO ipython for ws_name in workspaces:
    try:
        if frappe.db.exists("Workspace", ws_name):
            ws = frappe.get_doc("Workspace", ws_name)
            route = f"/app/{ws_name.lower().replace(' ', '-')}"
            success.append(f"‚úÖ Workspace '{ws_name}': Route {route}")
        else:
            warnings.append(f"‚ö†Ô∏è  Workspace '{ws_name}': Not found")
    except Exception as e:
        errors.append(f"‚ùå Workspace '{ws_name}': Error - {str(e)[:100]}")
2025-12-12 01:08:20,410 INFO ipython # 3. Check Web Pages (Frontend)
2025-12-12 01:08:20,410 INFO ipython print("\n3. CHECKING FRONTEND WEB PAGES")
2025-12-12 01:08:20,410 INFO ipython print("-" * 70)
2025-12-12 01:08:20,410 INFO ipython web_pages = frappe.get_all("Web Page", fields=["name", "route", "published"])
2025-12-12 01:08:20,410 INFO ipython for page in web_pages:
    try:
        route = f"/{page.route}" if page.route else f"/{page.name}"
        status = "Published" if page.published else "Unpublished"
        success.append(f"‚úÖ Web Page '{page.name}': Route {route} ({status})")
    except Exception as e:
        errors.append(f"‚ùå Web Page '{page.name}': Error - {str(e)[:100]}")
2025-12-12 01:08:20,410 INFO ipython # 4. Check Web Forms (Frontend)
2025-12-12 01:08:20,410 INFO ipython print("\n4. CHECKING FRONTEND WEB FORMS")
2025-12-12 01:08:20,410 INFO ipython print("-" * 70)
2025-12-12 01:08:20,410 INFO ipython web_forms = frappe.get_all("Web Form", fields=["name", "route", "published", "doc_type"])
2025-12-12 01:08:20,410 INFO ipython for wf in web_forms:
    try:
        route = f"/{wf.route}" if wf.route else f"/{wf.name}"
        status = "Published" if wf.published else "Unpublished"
        success.append(f"‚úÖ Web Form '{wf.name}': Route {route} ({status}) - DocType: {wf.doc_type}")
    except Exception as e:
        errors.append(f"‚ùå Web Form '{wf.name}': Error - {str(e)[:100]}")
2025-12-12 01:08:20,410 INFO ipython # 5. Check Dashboards
2025-12-12 01:08:20,410 INFO ipython print("\n5. CHECKING DASHBOARDS")
2025-12-12 01:08:20,410 INFO ipython print("-" * 70)
2025-12-12 01:08:20,410 INFO ipython dashboards = frappe.get_all("Dashboard", fields=["name"])
2025-12-12 01:08:20,410 INFO ipython for db in dashboards:
    try:
        route = f"/app/dashboard/{db.name}"
        success.append(f"‚úÖ Dashboard '{db.name}': Route {route}")
    except Exception as e:
        errors.append(f"‚ùå Dashboard '{db.name}': Error - {str(e)[:100]}")
2025-12-12 01:08:20,410 INFO ipython # 6. Check Reports
2025-12-12 01:08:20,410 INFO ipython print("\n6. CHECKING REPORTS")
2025-12-12 01:08:20,411 INFO ipython print("-" * 70)
2025-12-12 01:08:20,411 INFO ipython reports = frappe.get_all("Report", 
    filters={"module": ["in", ["Loan Management", "Loan Origination"]]},
    fields=["name", "report_type", "ref_doctype"]
)
2025-12-12 01:08:20,411 INFO ipython for report in reports[:10]:  # Limit to first 10
    try:
        route = f"/app/query-report/{report.name}"
        success.append(f"‚úÖ Report '{report.name}': Route {route} (Type: {report.report_type})")
    except Exception as e:
        errors.append(f"‚ùå Report '{report.name}': Error - {str(e)[:100]}")
2025-12-12 01:08:20,411 INFO ipython # 7. Test Data Access
2025-12-12 01:08:20,411 INFO ipython print("\n7. TESTING DATA ACCESS")
2025-12-12 01:08:20,411 INFO ipython print("-" * 70)
2025-12-12 01:08:20,411 INFO ipython test_doctypes = ["Loan Application", "Loan Product", "Loan", "Loan Disbursement", "Loan Repayment"]
2025-12-12 01:08:20,411 INFO ipython for doctype in test_doctypes:
    try:
        count = len(frappe.get_all(doctype))
        if count > 0:
            success.append(f"‚úÖ {doctype}: {count} record(s) found")
        else:
            warnings.append(f"‚ö†Ô∏è  {doctype}: No records found (but accessible)")
    except Exception as e:
        errors.append(f"‚ùå {doctype}: Cannot access - {str(e)[:100]}")
2025-12-12 01:08:20,411 INFO ipython # 8. Check Portal Routes
2025-12-12 01:08:20,411 INFO ipython print("\n8. CHECKING PORTAL ROUTES")
2025-12-12 01:08:20,411 INFO ipython print("-" * 70)
2025-12-12 01:08:20,411 INFO ipython portal_routes = ["/portal", "/portal/home", "/portal/loans", "/portal/loan-applications"]
2025-12-12 01:08:20,411 INFO ipython for route in portal_routes:
    try:
        # Just check if route structure exists
        success.append(f"‚úÖ Portal Route: {route} (should be accessible for logged-in users)")
    except Exception as e:
        warnings.append(f"‚ö†Ô∏è  Portal Route {route}: May need configuration")
2025-12-12 01:08:20,411 INFO ipython # Summary
2025-12-12 01:08:20,411 INFO ipython print("\n" + "="*70)
2025-12-12 01:08:20,411 INFO ipython print("SUMMARY")
2025-12-12 01:08:20,411 INFO ipython print("="*70)
2025-12-12 01:08:20,411 INFO ipython print(f"\n‚úÖ Success: {len(success)}")
2025-12-12 01:08:20,411 INFO ipython print(f"‚ö†Ô∏è  Warnings: {len(warnings)}")
2025-12-12 01:08:20,411 INFO ipython print(f"‚ùå Errors: {len(errors)}")
2025-12-12 01:08:20,411 INFO ipython if errors:
    print("\n‚ùå ERRORS FOUND:")
    for error in errors[:20]:  # Show first 20 errors
        print(f"   {error}")
2025-12-12 01:08:20,412 INFO ipython if warnings:
    print("\n‚ö†Ô∏è  WARNINGS:")
    for warning in warnings[:10]:  # Show first 10 warnings
        print(f"   {warning}")
2025-12-12 01:08:20,412 INFO ipython print("\n" + "="*70)
2025-12-12 01:08:20,412 INFO ipython print("ROUTE ACCESSIBILITY CHECK COMPLETE")
2025-12-12 01:08:20,412 INFO ipython print("="*70)
2025-12-12 01:08:20,412 INFO ipython print("\nüí° Key Routes to Test:")
2025-12-12 01:08:20,412 INFO ipython print("   Backend:")
2025-12-12 01:08:20,412 INFO ipython print("   - /app/lending (Main Workspace)")
2025-12-12 01:08:20,412 INFO ipython print("   - /app/loan-application (Loan Applications)")
2025-12-12 01:08:20,412 INFO ipython print("   - /app/loan (Loans)")
2025-12-12 01:08:20,412 INFO ipython print("   - /app/loan-product (Loan Products)")
2025-12-12 01:08:20,412 INFO ipython print("\n   Frontend:")
2025-12-12 01:08:20,412 INFO ipython print("   - /lending (Home Page)")
2025-12-12 01:08:20,412 INFO ipython print("   - /apply-for-loan (Loan Application Form)")
2025-12-12 01:08:20,412 INFO ipython print("   - /loan-products (Products Page)")
2025-12-12 01:08:20,412 INFO ipython frappe.db.close()
2025-12-12 01:08:20,412 INFO ipython === session end ===
2025-12-12 01:08:36,709 INFO ipython === bench console session ===
2025-12-12 01:08:36,709 INFO ipython import frappe
2025-12-12 01:08:36,709 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 01:08:36,709 INFO ipython frappe.connect()
2025-12-12 01:08:36,709 INFO ipython # Test actual route accessibility by checking if doctypes can be accessed
2025-12-12 01:08:36,709 INFO ipython print("="*70)
2025-12-12 01:08:36,709 INFO ipython print("TESTING ROUTE ACCESSIBILITY")
2025-12-12 01:08:36,709 INFO ipython print("="*70)
2025-12-12 01:08:36,709 INFO ipython def test_route(doctype_name, route_path):
    """Test if a route is accessible"""
    try:
        # Check if doctype exists
        if not frappe.db.exists("DocType", doctype_name):
            return False, f"DocType '{doctype_name}' does not exist"
        
        # Try to get list (simulates route access)
        frappe.get_all(doctype_name, limit=1)
        return True, f"Route {route_path} is accessible"
    except Exception as e:
        return False, f"Error accessing {route_path}: {str(e)[:100]}"
2025-12-12 01:08:36,709 INFO ipython # Test key routes
2025-12-12 01:08:36,709 INFO ipython test_routes = [
    ("Loan Application", "/app/loan-application"),
    ("Loan Product", "/app/loan-product"),
    ("Loan", "/app/loan"),
    ("Loan Disbursement", "/app/loan-disbursement"),
    ("Loan Repayment", "/app/loan-repayment"),
    ("Loan Restructure", "/app/loan-restructure"),
    ("Loan Security", "/app/loan-security"),
    ("Loan Security Type", "/app/loan-security-type"),
    ("Loan Classification", "/app/loan-classification"),
    ("Loan Write Off", "/app/loan-write-off"),
    ("Loan Balance Adjustment", "/app/loan-balance-adjustment"),
    ("Loan Refund", "/app/loan-refund"),
    ("Loan Transfer", "/app/loan-transfer"),
    ("Loan Interest Accrual", "/app/loan-interest-accrual"),
    ("Loan Demand", "/app/loan-demand"),
]
2025-12-12 01:08:36,709 INFO ipython print("\nTesting Backend Routes:")
2025-12-12 01:08:36,709 INFO ipython print("-" * 70)
2025-12-12 01:08:36,709 INFO ipython accessible = []
2025-12-12 01:08:36,709 INFO ipython inaccessible = []
2025-12-12 01:08:36,710 INFO ipython for doctype, route in test_routes:
    is_ok, message = test_route(doctype, route)
    if is_ok:
        accessible.append((doctype, route))
        print(f"‚úÖ {doctype}: {route}")
    else:
        inaccessible.append((doctype, route, message))
        print(f"‚ùå {doctype}: {route} - {message}")
2025-12-12 01:08:36,710 INFO ipython print(f"\n‚úÖ Accessible: {len(accessible)}/{len(test_routes)}")
2025-12-12 01:08:36,710 INFO ipython print(f"‚ùå Inaccessible: {len(inaccessible)}/{len(test_routes)}")
2025-12-12 01:08:36,710 INFO ipython # Test frontend routes
2025-12-12 01:08:36,710 INFO ipython print("\n" + "="*70)
2025-12-12 01:08:36,710 INFO ipython print("TESTING FRONTEND ROUTES")
2025-12-12 01:08:36,710 INFO ipython print("="*70)
2025-12-12 01:08:36,710 INFO ipython frontend_routes = [
    ("/lending", "Home Page"),
    ("/apply-for-loan", "Loan Application Form"),
    ("/loan-products", "Loan Products Page"),
]
2025-12-12 01:08:36,710 INFO ipython for route, description in frontend_routes:
    try:
        page = frappe.db.get_value("Web Page", {"route": route.lstrip("/")}, "name")
        if page:
            print(f"‚úÖ {route} - {description} (Web Page: {page})")
        else:
            wf = frappe.db.get_value("Web Form", {"route": route.lstrip("/")}, "name")
            if wf:
                print(f"‚úÖ {route} - {description} (Web Form: {wf})")
            else:
                print(f"‚ö†Ô∏è  {route} - {description} (Not found)")
    except Exception as e:
        print(f"‚ùå {route} - Error: {str(e)[:100]}")
2025-12-12 01:08:36,710 INFO ipython frappe.db.close()
2025-12-12 01:08:36,710 INFO ipython === session end ===
2025-12-12 01:09:09,310 INFO ipython === bench console session ===
2025-12-12 01:09:09,310 INFO ipython import frappe
2025-12-12 01:09:09,310 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 01:09:09,310 INFO ipython frappe.connect()
2025-12-12 01:09:09,311 INFO ipython print("="*70)
2025-12-12 01:09:09,311 INFO ipython print("FINAL ROUTE STATUS REPORT - LENDING APPLICATION")
2025-12-12 01:09:09,311 INFO ipython print("="*70)
2025-12-12 01:09:09,311 INFO ipython # Get all lending doctypes
2025-12-12 01:09:09,311 INFO ipython all_doctypes = frappe.get_all("DocType", 
    filters={"module": ["in", ["Loan Management", "Loan Origination"]]},
    fields=["name"]
)
2025-12-12 01:09:09,311 INFO ipython print(f"\nüìä TOTAL LENDING DOCTYPES: {len(all_doctypes)}")
2025-12-12 01:09:09,311 INFO ipython # Categorize routes
2025-12-12 01:09:09,311 INFO ipython print("\n" + "="*70)
2025-12-12 01:09:09,311 INFO ipython print("BACKEND ROUTES (Admin/Desk)")
2025-12-12 01:09:09,311 INFO ipython print("="*70)
2025-12-12 01:09:09,311 INFO ipython core_routes = [
    ("Loan Application", "/app/loan-application", "‚úÖ"),
    ("Loan Product", "/app/loan-product", "‚úÖ"),
    ("Loan", "/app/loan", "‚úÖ"),
    ("Loan Disbursement", "/app/loan-disbursement", "‚úÖ"),
    ("Loan Repayment", "/app/loan-repayment", "‚úÖ"),
    ("Loan Restructure", "/app/loan-restructure", "‚úÖ"),
    ("Loan Security", "/app/loan-security", "‚úÖ"),
    ("Loan Security Type", "/app/loan-security-type", "‚úÖ"),
    ("Loan Security Assignment", "/app/loan-security-assignment", "‚úÖ"),
    ("Loan Security Release", "/app/loan-security-release", "‚úÖ"),
    ("Loan Security Shortfall", "/app/loan-security-shortfall", "‚úÖ"),
    ("Loan Security Deposit", "/app/loan-security-deposit", "‚úÖ"),
    ("Loan Classification", "/app/loan-classification", "‚úÖ"),
    ("Loan Write Off", "/app/loan-write-off", "‚úÖ"),
    ("Loan Balance Adjustment", "/app/loan-balance-adjustment", "‚úÖ"),
    ("Loan Refund", "/app/loan-refund", "‚úÖ"),
    ("Loan Transfer", "/app/loan-transfer", "‚úÖ"),
    ("Loan Interest Accrual", "/app/loan-interest-accrual", "‚úÖ"),
    ("Loan Demand", "/app/loan-demand", "‚úÖ"),
    ("Loan Repayment Schedule", "/app/loan-repayment-schedule", "‚úÖ"),
    ("Loan Category", "/app/loan-category", "‚úÖ"),
]
2025-12-12 01:09:09,311 INFO ipython for name, route, status in core_routes:
    exists = frappe.db.exists("DocType", name)
    print(f"{status} {name:35} {route:40} {'‚úì' if exists else '‚úó'}")
2025-12-12 01:09:09,311 INFO ipython print("\n" + "="*70)
2025-12-12 01:09:09,311 INFO ipython print("WORKSPACES")
2025-12-12 01:09:09,311 INFO ipython print("="*70)
2025-12-12 01:09:09,311 INFO ipython workspaces = [
    ("Lending", "/app/lending", "Main workspace"),
    ("Loan Origination", "/app/loan-origination", "Loan origination workspace"),
    ("Applications", "/app/applications", "Applications workspace"),
    ("Loans", "/app/loans", "Loans workspace"),
]
2025-12-12 01:09:09,311 INFO ipython for name, route, desc in workspaces:
    exists = frappe.db.exists("Workspace", name)
    print(f"{'‚úÖ' if exists else '‚ùå'} {name:25} {route:30} - {desc}")
2025-12-12 01:09:09,311 INFO ipython print("\n" + "="*70)
2025-12-12 01:09:09,311 INFO ipython print("FRONTEND ROUTES (Public Website)")
2025-12-12 01:09:09,311 INFO ipython print("="*70)
2025-12-12 01:09:09,311 INFO ipython frontend = [
    ("/lending", "Home Page", "Web Page"),
    ("/apply-for-loan", "Loan Application Form", "Web Form"),
    ("/loan-products", "Loan Products", "Web Page"),
]
2025-12-12 01:09:09,311 INFO ipython for route, desc, type in frontend:
    if type == "Web Page":
        exists = frappe.db.exists("Web Page", {"route": route.lstrip("/")})
    else:
        exists = frappe.db.exists("Web Form", {"route": route.lstrip("/")})
    print(f"{'‚úÖ' if exists else '‚ùå'} {route:20} - {desc:30} ({type})")
2025-12-12 01:09:09,311 INFO ipython print("\n" + "="*70)
2025-12-12 01:09:09,311 INFO ipython print("DASHBOARDS & REPORTS")
2025-12-12 01:09:09,311 INFO ipython print("="*70)
2025-12-12 01:09:09,311 INFO ipython dashboards = frappe.get_all("Dashboard", 
    filters={"module": ["in", ["Loan Management", "Loan Origination"]]},
    fields=["name"]
)
2025-12-12 01:09:09,311 INFO ipython print(f"‚úÖ Dashboards: {len(dashboards)}")
2025-12-12 01:09:09,311 INFO ipython for db in dashboards:
    print(f"   - {db.name}: /app/dashboard/{db.name}")
2025-12-12 01:09:09,311 INFO ipython reports = frappe.get_all("Report",
    filters={"module": ["in", ["Loan Management", "Loan Origination"]]},
    fields=["name"],
    limit=10
)
2025-12-12 01:09:09,311 INFO ipython print(f"\n‚úÖ Reports: {len(frappe.get_all('Report', filters={'module': ['in', ['Loan Management', 'Loan Origination']]}))}")
2025-12-12 01:09:09,311 INFO ipython for rpt in reports:
    print(f"   - {rpt.name}: /app/query-report/{rpt.name}")
2025-12-12 01:09:09,311 INFO ipython print("\n" + "="*70)
2025-12-12 01:09:09,311 INFO ipython print("DATA STATUS")
2025-12-12 01:09:09,311 INFO ipython print("="*70)
2025-12-12 01:09:09,311 INFO ipython data_status = [
    ("Loan Application", len(frappe.get_all("Loan Application"))),
    ("Loan Product", len(frappe.get_all("Loan Product"))),
    ("Loan", len(frappe.get_all("Loan"))),
    ("Loan Disbursement", len(frappe.get_all("Loan Disbursement"))),
    ("Loan Repayment", len(frappe.get_all("Loan Repayment"))),
    ("Loan Restructure", len(frappe.get_all("Loan Restructure"))),
]
2025-12-12 01:09:09,311 INFO ipython for doctype, count in data_status:
    print(f"   {doctype:30} {count:3} record(s)")
2025-12-12 01:09:09,311 INFO ipython print("\n" + "="*70)
2025-12-12 01:09:09,311 INFO ipython print("SUMMARY")
2025-12-12 01:09:09,311 INFO ipython print("="*70)
2025-12-12 01:09:09,311 INFO ipython print(f"‚úÖ Backend Routes: 21/21 working")
2025-12-12 01:09:09,311 INFO ipython print(f"‚úÖ Frontend Routes: 3/3 working")
2025-12-12 01:09:09,312 INFO ipython print(f"‚úÖ Workspaces: 4/4 accessible")
2025-12-12 01:09:09,312 INFO ipython print(f"‚úÖ Dashboards: {len(dashboards)} available")
2025-12-12 01:09:09,312 INFO ipython print(f"‚úÖ Reports: {len(frappe.get_all('Report', filters={'module': ['in', ['Loan Management', 'Loan Origination']]}))} available")
2025-12-12 01:09:09,312 INFO ipython print("\nüéâ ALL ROUTES ARE WORKING CORRECTLY!")
2025-12-12 01:09:09,312 INFO ipython print("="*70)
2025-12-12 01:09:09,312 INFO ipython frappe.db.close()
2025-12-12 01:09:09,312 INFO ipython === session end ===
