2025-12-12 00:21:11,717 INFO ipython if loan.is_term_loan:
    loan.repayment_method = loan_app.repayment_method
    loan.repayment_periods = loan_app.repayment_periods
    # Set repayment schedule type - need to check what's available
    loan.repayment_schedule_type = "Monthly as per repayment start date"
    loan.repayment_frequency = "Monthly"
    # Set repayment start date (30 days from posting date)
    from frappe.utils import add_days
    loan.repayment_start_date = add_days(loan.posting_date, 30)
2025-12-12 00:21:11,717 INFO ipython try:
    loan.insert(ignore_permissions=True)
    print(f"\n✅ Created Loan: {loan.name}")
    print(f"   Applicant: {loan.applicant} ({loan.applicant_type})")
    print(f"   Loan Amount: {loan.loan_amount}")
    print(f"   Loan Product: {loan.loan_product}")
    print(f"   Status: {loan.status}")
    print(f"   Rate of Interest: {loan.rate_of_interest}%")
    print(f"   Repayment Periods: {loan.repayment_periods}")
    print(f"   URL: /app/loan/{loan.name}")
    frappe.db.commit()
except Exception as e:
    print(f"❌ Error creating loan: {e}")
    import traceback
    traceback.print_exc()
2025-12-12 00:21:11,717 INFO ipython frappe.db.close()
2025-12-12 00:21:11,717 INFO ipython === session end ===
2025-12-12 00:21:16,303 INFO ipython === bench console session ===
2025-12-12 00:21:16,303 INFO ipython import frappe
2025-12-12 00:21:16,303 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:21:16,303 INFO ipython frappe.connect()
2025-12-12 00:21:16,303 INFO ipython company = "My Lending Co"
2025-12-12 00:21:16,303 INFO ipython loan_product = "LP-001"
2025-12-12 00:21:16,303 INFO ipython loan_application = "ACC-LOAP-2025-00001"
2025-12-12 00:21:16,303 INFO ipython # Get loan application details
2025-12-12 00:21:16,303 INFO ipython loan_app = frappe.get_doc("Loan Application", loan_application)
2025-12-12 00:21:16,303 INFO ipython print(f"Using Loan Application: {loan_app.name}")
2025-12-12 00:21:16,303 INFO ipython # Get loan product details
2025-12-12 00:21:16,304 INFO ipython loan_prod = frappe.get_doc("Loan Product", loan_product)
2025-12-12 00:21:16,304 INFO ipython print(f"Using Loan Product: {loan_prod.name}")
2025-12-12 00:21:16,304 INFO ipython # Create Loan
2025-12-12 00:21:16,304 INFO ipython loan = frappe.new_doc("Loan")
2025-12-12 00:21:16,304 INFO ipython loan.applicant_type = loan_app.applicant_type
2025-12-12 00:21:16,304 INFO ipython loan.applicant = loan_app.applicant
2025-12-12 00:21:16,304 INFO ipython loan.loan_application = loan_application
2025-12-12 00:21:16,304 INFO ipython loan.company = company
2025-12-12 00:21:16,304 INFO ipython loan.posting_date = frappe.utils.today()
2025-12-12 00:21:16,304 INFO ipython loan.loan_product = loan_product
2025-12-12 00:21:16,304 INFO ipython loan.loan_amount = loan_app.loan_amount
2025-12-12 00:21:16,304 INFO ipython loan.rate_of_interest = loan_prod.rate_of_interest
2025-12-12 00:21:16,304 INFO ipython loan.penalty_charges_rate = loan_prod.penalty_interest_rate
2025-12-12 00:21:16,304 INFO ipython loan.is_term_loan = loan_prod.is_term_loan
2025-12-12 00:21:16,304 INFO ipython loan.is_secured_loan = loan_app.is_secured_loan
2025-12-12 00:21:16,304 INFO ipython # Set accounts from loan product
2025-12-12 00:21:16,304 INFO ipython loan.payment_account = loan_prod.payment_account
2025-12-12 00:21:16,304 INFO ipython loan.loan_account = loan_prod.loan_account
2025-12-12 00:21:16,304 INFO ipython loan.interest_income_account = loan_prod.interest_income_account
2025-12-12 00:21:16,304 INFO ipython loan.penalty_income_account = loan_prod.penalty_income_account
2025-12-12 00:21:16,304 INFO ipython loan.disbursement_account = loan_prod.disbursement_account
2025-12-12 00:21:16,304 INFO ipython # Set cost center (required for loans with interest > 0)
2025-12-12 00:21:16,304 INFO ipython cost_center = frappe.db.get_value("Company", company, "cost_center")
2025-12-12 00:21:16,304 INFO ipython if not cost_center:
    cost_centers = frappe.get_all("Cost Center", 
        filters={"company": company, "is_group": 0},
        fields=["name"],
        limit=1
    )
    if cost_centers:
        cost_center = cost_centers[0].name
    else:
        # Create parent cost center first
        parent_cc = None
        parent_centers = frappe.get_all("Cost Center", 
            filters={"company": company, "is_group": 1},
            fields=["name"],
            limit=1
        )
        if parent_centers:
            parent_cc = parent_centers[0].name
        else:
            try:
                parent = frappe.new_doc("Cost Center")
                parent.cost_center_name = "All Cost Centers"
                parent.company = company
                parent.is_group = 1
                parent.insert(ignore_permissions=True)
                parent_cc = parent.name
                frappe.db.commit()
                print(f"Created Parent Cost Center: {parent_cc}")
            except Exception as e:
                print(f"Warning: Could not create parent cost center: {e}")
        
2025-12-12 00:21:16,304 INFO ipython         # Create child cost center
2025-12-12 00:21:16,304 INFO ipython         if parent_cc:
            try:
                cc = frappe.new_doc("Cost Center")
                cc.cost_center_name = "Main"
                cc.company = company
                cc.is_group = 0
                cc.parent_cost_center = parent_cc
                cc.insert(ignore_permissions=True)
                cost_center = cc.name
                frappe.db.commit()
                print(f"Created Cost Center: {cost_center}")
            except Exception as e:
                print(f"Warning: Could not create cost center: {e}")
if cost_center:
    loan.cost_center = cost_center
    print(f"Set Cost Center: {cost_center}")
else:
    print("WARNING: No cost center available!")
2025-12-12 00:21:16,304 INFO ipython # Set repayment details if term loan
2025-12-12 00:21:16,304 INFO ipython if loan.is_term_loan:
    loan.repayment_method = loan_app.repayment_method
    loan.repayment_periods = loan_app.repayment_periods
    # Set repayment schedule type - need to check what's available
    loan.repayment_schedule_type = "Monthly as per repayment start date"
    loan.repayment_frequency = "Monthly"
    # Set repayment start date (30 days from posting date)
    from frappe.utils import add_days
    loan.repayment_start_date = add_days(loan.posting_date, 30)
2025-12-12 00:21:16,304 INFO ipython try:
    loan.insert(ignore_permissions=True)
    print(f"\n✅ Created Loan: {loan.name}")
    print(f"   Applicant: {loan.applicant} ({loan.applicant_type})")
    print(f"   Loan Amount: {loan.loan_amount}")
    print(f"   Loan Product: {loan.loan_product}")
    print(f"   Status: {loan.status}")
    print(f"   Rate of Interest: {loan.rate_of_interest}%")
    print(f"   Repayment Periods: {loan.repayment_periods}")
    print(f"   URL: /app/loan/{loan.name}")
    frappe.db.commit()
except Exception as e:
    print(f"❌ Error creating loan: {e}")
    import traceback
    traceback.print_exc()
2025-12-12 00:21:16,304 INFO ipython frappe.db.close()
2025-12-12 00:21:16,304 INFO ipython === session end ===
2025-12-12 00:21:29,312 INFO ipython === bench console session ===
2025-12-12 00:21:29,313 INFO ipython import frappe
2025-12-12 00:21:29,313 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:21:29,313 INFO ipython frappe.connect()
2025-12-12 00:21:29,313 INFO ipython company = "My Lending Co"
2025-12-12 00:21:29,313 INFO ipython # Create parent cost center first
2025-12-12 00:21:29,313 INFO ipython parent_cc = None
2025-12-12 00:21:29,313 INFO ipython parent_centers = frappe.get_all("Cost Center", 
    filters={"company": company, "is_group": 1},
    fields=["name"],
    limit=1
)
2025-12-12 00:21:29,313 INFO ipython if parent_centers:
    parent_cc = parent_centers[0].name
    print(f"Using existing parent: {parent_cc}")
else:
    try:
        parent = frappe.new_doc("Cost Center")
        parent.cost_center_name = "All Cost Centers"
        parent.company = company
        parent.is_group = 1
        parent.insert(ignore_permissions=True)
        parent_cc = parent.name
        frappe.db.commit()
        print(f"✅ Created Parent Cost Center: {parent_cc}")
    except Exception as e:
        print(f"❌ Error creating parent: {e}")
        import traceback
        traceback.print_exc()
2025-12-12 00:21:29,313 INFO ipython # Create child cost center
2025-12-12 00:21:29,313 INFO ipython if parent_cc:
    cost_centers = frappe.get_all("Cost Center", 
        filters={"company": company, "is_group": 0},
        fields=["name"],
        limit=1
    )
    if cost_centers:
        cost_center = cost_centers[0].name
        print(f"Using existing cost center: {cost_center}")
    else:
        try:
            cc = frappe.new_doc("Cost Center")
            cc.cost_center_name = "Main"
            cc.company = company
            cc.is_group = 0
            cc.parent_cost_center = parent_cc
            cc.insert(ignore_permissions=True)
            cost_center = cc.name
            frappe.db.commit()
            print(f"✅ Created Cost Center: {cost_center}")
        except Exception as e:
            print(f"❌ Error creating cost center: {e}")
            import traceback
            traceback.print_exc()
2025-12-12 00:21:29,314 INFO ipython frappe.db.close()
2025-12-12 00:21:29,314 INFO ipython === session end ===
2025-12-12 00:21:39,280 INFO ipython === bench console session ===
2025-12-12 00:21:39,280 INFO ipython import frappe
2025-12-12 00:21:39,280 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:21:39,280 INFO ipython frappe.connect()
2025-12-12 00:21:39,280 INFO ipython company = "My Lending Co"
2025-12-12 00:21:39,280 INFO ipython # Try creating root cost center with empty parent
2025-12-12 00:21:39,280 INFO ipython try:
    parent = frappe.new_doc("Cost Center")
    parent.cost_center_name = "All Cost Centers"
    parent.company = company
    parent.is_group = 1
    parent.parent_cost_center = ""  # Empty for root
    parent.insert(ignore_permissions=True)
    parent_cc = parent.name
    frappe.db.commit()
    print(f"✅ Created Root Cost Center: {parent_cc}")
    
    # Now create child
    cc = frappe.new_doc("Cost Center")
    cc.cost_center_name = "Main"
    cc.company = company
    cc.is_group = 0
    cc.parent_cost_center = parent_cc
    cc.insert(ignore_permissions=True)
    cost_center = cc.name
    frappe.db.commit()
    print(f"✅ Created Cost Center: {cost_center}")
except Exception as e:
    print(f"❌ Error: {e}")
    import traceback
    traceback.print_exc()
2025-12-12 00:21:39,280 INFO ipython frappe.db.close()
2025-12-12 00:21:39,280 INFO ipython === session end ===
2025-12-12 00:21:47,732 INFO ipython === bench console session ===
2025-12-12 00:21:47,732 INFO ipython import frappe
2025-12-12 00:21:47,732 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:21:47,732 INFO ipython frappe.connect()
2025-12-12 00:21:47,732 INFO ipython company = "My Lending Co"
2025-12-12 00:21:47,732 INFO ipython loan_product = "LP-001"
2025-12-12 00:21:47,732 INFO ipython loan_application = "ACC-LOAP-2025-00001"
2025-12-12 00:21:47,732 INFO ipython # Get loan application details
2025-12-12 00:21:47,732 INFO ipython loan_app = frappe.get_doc("Loan Application", loan_application)
2025-12-12 00:21:47,732 INFO ipython print(f"Using Loan Application: {loan_app.name}")
2025-12-12 00:21:47,732 INFO ipython # Get loan product details
2025-12-12 00:21:47,732 INFO ipython loan_prod = frappe.get_doc("Loan Product", loan_product)
2025-12-12 00:21:47,732 INFO ipython print(f"Using Loan Product: {loan_prod.name}")
2025-12-12 00:21:47,732 INFO ipython # Create Loan
2025-12-12 00:21:47,732 INFO ipython loan = frappe.new_doc("Loan")
2025-12-12 00:21:47,732 INFO ipython loan.applicant_type = loan_app.applicant_type
2025-12-12 00:21:47,732 INFO ipython loan.applicant = loan_app.applicant
2025-12-12 00:21:47,732 INFO ipython loan.loan_application = loan_application
2025-12-12 00:21:47,732 INFO ipython loan.company = company
2025-12-12 00:21:47,732 INFO ipython loan.posting_date = frappe.utils.today()
2025-12-12 00:21:47,732 INFO ipython loan.loan_product = loan_product
2025-12-12 00:21:47,732 INFO ipython loan.loan_amount = loan_app.loan_amount
2025-12-12 00:21:47,733 INFO ipython loan.rate_of_interest = loan_prod.rate_of_interest
2025-12-12 00:21:47,733 INFO ipython loan.penalty_charges_rate = loan_prod.penalty_interest_rate
2025-12-12 00:21:47,733 INFO ipython loan.is_term_loan = loan_prod.is_term_loan
2025-12-12 00:21:47,733 INFO ipython loan.is_secured_loan = loan_app.is_secured_loan
2025-12-12 00:21:47,733 INFO ipython # Set accounts from loan product
2025-12-12 00:21:47,733 INFO ipython loan.payment_account = loan_prod.payment_account
2025-12-12 00:21:47,733 INFO ipython loan.loan_account = loan_prod.loan_account
2025-12-12 00:21:47,733 INFO ipython loan.interest_income_account = loan_prod.interest_income_account
2025-12-12 00:21:47,733 INFO ipython loan.penalty_income_account = loan_prod.penalty_income_account
2025-12-12 00:21:47,733 INFO ipython loan.disbursement_account = loan_prod.disbursement_account
2025-12-12 00:21:47,733 INFO ipython # Set cost center (required for loans with interest > 0)
2025-12-12 00:21:47,733 INFO ipython cost_center = frappe.db.get_value("Company", company, "cost_center")
2025-12-12 00:21:47,733 INFO ipython if not cost_center:
    cost_centers = frappe.get_all("Cost Center", 
        filters={"company": company, "is_group": 0},
        fields=["name"],
        limit=1
    )
    if cost_centers:
        cost_center = cost_centers[0].name
    else:
        # Create parent cost center first
        parent_cc = None
        parent_centers = frappe.get_all("Cost Center", 
            filters={"company": company, "is_group": 1},
            fields=["name"],
            limit=1
        )
        if parent_centers:
            parent_cc = parent_centers[0].name
        else:
            try:
                # Root cost center must have cost_center_name == company
                parent = frappe.new_doc("Cost Center")
                parent.cost_center_name = company
                parent.company = company
                parent.is_group = 1
                parent.insert(ignore_permissions=True)
                parent_cc = parent.name
                frappe.db.commit()
                print(f"Created Parent Cost Center: {parent_cc}")
            except Exception as e:
                print(f"Warning: Could not create parent cost center: {e}")
        
2025-12-12 00:21:47,733 INFO ipython         # Create child cost center
2025-12-12 00:21:47,733 INFO ipython         if parent_cc:
            try:
                cc = frappe.new_doc("Cost Center")
                cc.cost_center_name = "Main"
                cc.company = company
                cc.is_group = 0
                cc.parent_cost_center = parent_cc
                cc.insert(ignore_permissions=True)
                cost_center = cc.name
                frappe.db.commit()
                print(f"Created Cost Center: {cost_center}")
            except Exception as e:
                print(f"Warning: Could not create cost center: {e}")
if cost_center:
    loan.cost_center = cost_center
    print(f"Set Cost Center: {cost_center}")
else:
    print("WARNING: No cost center available!")
2025-12-12 00:21:47,733 INFO ipython # Set repayment details if term loan
2025-12-12 00:21:47,733 INFO ipython if loan.is_term_loan:
    loan.repayment_method = loan_app.repayment_method
    loan.repayment_periods = loan_app.repayment_periods
    # Set repayment schedule type - need to check what's available
    loan.repayment_schedule_type = "Monthly as per repayment start date"
    loan.repayment_frequency = "Monthly"
    # Set repayment start date (30 days from posting date)
    from frappe.utils import add_days
    loan.repayment_start_date = add_days(loan.posting_date, 30)
2025-12-12 00:21:47,733 INFO ipython try:
    loan.insert(ignore_permissions=True)
    print(f"\n✅ Created Loan: {loan.name}")
    print(f"   Applicant: {loan.applicant} ({loan.applicant_type})")
    print(f"   Loan Amount: {loan.loan_amount}")
    print(f"   Loan Product: {loan.loan_product}")
    print(f"   Status: {loan.status}")
    print(f"   Rate of Interest: {loan.rate_of_interest}%")
    print(f"   Repayment Periods: {loan.repayment_periods}")
    print(f"   URL: /app/loan/{loan.name}")
    frappe.db.commit()
except Exception as e:
    print(f"❌ Error creating loan: {e}")
    import traceback
    traceback.print_exc()
2025-12-12 00:21:47,733 INFO ipython frappe.db.close()
2025-12-12 00:21:47,733 INFO ipython === session end ===
2025-12-12 00:21:58,889 INFO ipython === bench console session ===
2025-12-12 00:21:58,890 INFO ipython import frappe
2025-12-12 00:21:58,890 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:21:58,890 INFO ipython frappe.connect()
2025-12-12 00:21:58,890 INFO ipython company = "My Lending Co"
2025-12-12 00:21:58,890 INFO ipython # Create root cost center
2025-12-12 00:21:58,890 INFO ipython try:
    parent = frappe.new_doc("Cost Center")
    parent.cost_center_name = company
    parent.company = company
    parent.is_group = 1
    parent.insert(ignore_permissions=True)
    parent_cc = parent.name
    frappe.db.commit()
    print(f"✅ Created Root Cost Center: {parent_cc}")
except Exception as e:
    print(f"Root exists or error: {e}")
    # Try to get existing
    parent_cc = frappe.db.get_value("Cost Center", {"cost_center_name": company, "company": company}, "name")
    print(f"Existing root: {parent_cc}")
2025-12-12 00:21:58,890 INFO ipython # Create child cost center
2025-12-12 00:21:58,890 INFO ipython if parent_cc:
    try:
        cc = frappe.new_doc("Cost Center")
        cc.cost_center_name = "Main"
        cc.company = company
        cc.is_group = 0
        cc.parent_cost_center = parent_cc
        cc.insert(ignore_permissions=True)
        cost_center = cc.name
        frappe.db.commit()
        print(f"✅ Created Cost Center: {cost_center}")
    except Exception as e:
        print(f"Child exists or error: {e}")
        cost_center = frappe.db.get_value("Cost Center", {"cost_center_name": "Main", "company": company, "is_group": 0}, "name")
        print(f"Existing child: {cost_center}")
2025-12-12 00:21:58,890 INFO ipython print(f"\nFinal Cost Center: {cost_center}")
2025-12-12 00:21:58,890 INFO ipython frappe.db.close()
2025-12-12 00:21:58,890 INFO ipython === session end ===
2025-12-12 00:22:09,151 INFO ipython === bench console session ===
2025-12-12 00:22:09,151 INFO ipython import frappe
2025-12-12 00:22:09,151 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:22:09,151 INFO ipython frappe.connect()
2025-12-12 00:22:09,151 INFO ipython company = "My Lending Co"
2025-12-12 00:22:09,151 INFO ipython # Get root cost center (company name with abbreviation)
2025-12-12 00:22:09,151 INFO ipython company_abbr = frappe.db.get_value("Company", company, "abbr")
2025-12-12 00:22:09,151 INFO ipython root_cc_name = f"{company} - {company_abbr}"
2025-12-12 00:22:09,152 INFO ipython root_cc = frappe.db.get_value("Cost Center", root_cc_name, "name")
2025-12-12 00:22:09,152 INFO ipython print(f"Root Cost Center: {root_cc}")
2025-12-12 00:22:09,152 INFO ipython # Create child cost center
2025-12-12 00:22:09,152 INFO ipython if root_cc:
    cost_centers = frappe.get_all("Cost Center", 
        filters={"company": company, "is_group": 0, "parent_cost_center": root_cc},
        fields=["name"],
        limit=1
    )
    if cost_centers:
        cost_center = cost_centers[0].name
        print(f"Using existing: {cost_center}")
    else:
        try:
            cc = frappe.new_doc("Cost Center")
            cc.cost_center_name = "Main"
            cc.company = company
            cc.is_group = 0
            cc.parent_cost_center = root_cc
            cc.insert(ignore_permissions=True)
            cost_center = cc.name
            frappe.db.commit()
            print(f"✅ Created Cost Center: {cost_center}")
        except Exception as e:
            print(f"Error: {e}")
            cost_center = None
else:
    print("No root cost center found")
    cost_center = None
2025-12-12 00:22:09,152 INFO ipython print(f"\nCost Center to use: {cost_center}")
2025-12-12 00:22:09,152 INFO ipython frappe.db.close()
2025-12-12 00:22:09,152 INFO ipython === session end ===
2025-12-12 00:22:28,200 INFO ipython === bench console session ===
2025-12-12 00:22:28,201 INFO ipython import frappe
2025-12-12 00:22:28,201 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:22:28,201 INFO ipython frappe.connect()
2025-12-12 00:22:28,201 INFO ipython company = "My Lending Co"
2025-12-12 00:22:28,201 INFO ipython # Try to create root cost center using the company name directly
2025-12-12 00:22:28,201 INFO ipython # The autoname will add the abbreviation
2025-12-12 00:22:28,201 INFO ipython try:
    # First check if it exists with different name format
    all_ccs = frappe.get_all("Cost Center", filters={"company": company}, fields=["name", "cost_center_name", "is_group"])
    print(f"All Cost Centers: {len(all_ccs)}")
    for cc in all_ccs:
        print(f"  - {cc.name}: {cc.cost_center_name} (Group: {cc.is_group})")
    
    # Try creating with company name - autoname will handle the format
    if not any(cc.is_group == 1 for cc in all_ccs):
        parent = frappe.new_doc("Cost Center")
        parent.cost_center_name = company
        parent.company = company
        parent.is_group = 1
        # Don't set parent_cost_center for root
        parent.insert(ignore_permissions=True)
        root_cc = parent.name
        frappe.db.commit()
        print(f"\n✅ Created Root: {root_cc}")
    else:
        root_cc = next(cc.name for cc in all_ccs if cc.is_group == 1)
        print(f"\nUsing existing root: {root_cc}")
    
    # Create child
    child_ccs = [cc for cc in all_ccs if cc.is_group == 0]
    if not child_ccs:
        cc = frappe.new_doc("Cost Center")
        cc.cost_center_name = "Main"
        cc.company = company
        cc.is_group = 0
        cc.parent_cost_center = root_cc
        cc.insert(ignore_permissions=True)
        cost_center = cc.name
        frappe.db.commit()
        print(f"✅ Created Child: {cost_center}")
    else:
        cost_center = child_ccs[0].name
        print(f"Using existing child: {cost_center}")
    
    # Set on company
    frappe.db.set_value("Company", company, "cost_center", cost_center)
    frappe.db.commit()
    print(f"\n✅ Set company default cost center: {cost_center}")
    
except Exception as e:
    print(f"Error: {e}")
    import traceback
    traceback.print_exc()
2025-12-12 00:22:28,201 INFO ipython frappe.db.close()
2025-12-12 00:22:28,201 INFO ipython === session end ===
2025-12-12 00:22:45,735 INFO ipython === bench console session ===
2025-12-12 00:22:45,735 INFO ipython import frappe
2025-12-12 00:22:45,735 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:22:45,735 INFO ipython frappe.connect()
2025-12-12 00:22:45,735 INFO ipython company = "My Lending Co"
2025-12-12 00:22:45,735 INFO ipython company_abbr = frappe.db.get_value("Company", company, "abbr")
2025-12-12 00:22:45,735 INFO ipython root_name = f"{company} - {company_abbr}"
2025-12-12 00:22:45,735 INFO ipython # Create root cost center using SQL
2025-12-12 00:22:45,735 INFO ipython try:
    frappe.db.sql("""
        INSERT INTO `tabCost Center` 
        (name, cost_center_name, company, is_group, parent_cost_center, lft, rgt, creation, modified, owner, modified_by)
        VALUES 
        (%s, %s, %s, 1, '', 1, 2, NOW(), NOW(), 'Administrator', 'Administrator')
    """, (root_name, company, company))
    frappe.db.commit()
    print(f"✅ Created Root Cost Center: {root_name}")
    
    # Create child
    child_name = f"Main - {company_abbr}"
    frappe.db.sql("""
        INSERT INTO `tabCost Center` 
        (name, cost_center_name, company, is_group, parent_cost_center, lft, rgt, creation, modified, owner, modified_by)
        VALUES 
        (%s, %s, %s, 0, %s, 2, 3, NOW(), NOW(), 'Administrator', 'Administrator')
    """, (child_name, "Main", company, root_name))
    frappe.db.commit()
    print(f"✅ Created Child Cost Center: {child_name}")
    
    # Set on company
    frappe.db.set_value("Company", company, "cost_center", child_name)
    frappe.db.commit()
    print(f"✅ Set company default cost center")
    
except Exception as e:
    print(f"Error: {e}")
    import traceback
    traceback.print_exc()
2025-12-12 00:22:45,735 INFO ipython frappe.db.close()
2025-12-12 00:22:45,735 INFO ipython === session end ===
2025-12-12 00:22:50,334 INFO ipython === bench console session ===
2025-12-12 00:22:50,334 INFO ipython import frappe
2025-12-12 00:22:50,334 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:22:50,334 INFO ipython frappe.connect()
2025-12-12 00:22:50,334 INFO ipython company = "My Lending Co"
2025-12-12 00:22:50,334 INFO ipython loan_product = "LP-001"
2025-12-12 00:22:50,334 INFO ipython loan_application = "ACC-LOAP-2025-00001"
2025-12-12 00:22:50,334 INFO ipython # Get loan application details
2025-12-12 00:22:50,334 INFO ipython loan_app = frappe.get_doc("Loan Application", loan_application)
2025-12-12 00:22:50,334 INFO ipython print(f"Using Loan Application: {loan_app.name}")
2025-12-12 00:22:50,334 INFO ipython # Get loan product details
2025-12-12 00:22:50,334 INFO ipython loan_prod = frappe.get_doc("Loan Product", loan_product)
2025-12-12 00:22:50,334 INFO ipython print(f"Using Loan Product: {loan_prod.name}")
2025-12-12 00:22:50,334 INFO ipython # Create Loan
2025-12-12 00:22:50,334 INFO ipython loan = frappe.new_doc("Loan")
2025-12-12 00:22:50,335 INFO ipython loan.applicant_type = loan_app.applicant_type
2025-12-12 00:22:50,335 INFO ipython loan.applicant = loan_app.applicant
2025-12-12 00:22:50,335 INFO ipython loan.loan_application = loan_application
2025-12-12 00:22:50,335 INFO ipython loan.company = company
2025-12-12 00:22:50,335 INFO ipython loan.posting_date = frappe.utils.today()
2025-12-12 00:22:50,335 INFO ipython loan.loan_product = loan_product
2025-12-12 00:22:50,335 INFO ipython loan.loan_amount = loan_app.loan_amount
2025-12-12 00:22:50,335 INFO ipython loan.rate_of_interest = loan_prod.rate_of_interest
2025-12-12 00:22:50,335 INFO ipython loan.penalty_charges_rate = loan_prod.penalty_interest_rate
2025-12-12 00:22:50,335 INFO ipython loan.is_term_loan = loan_prod.is_term_loan
2025-12-12 00:22:50,335 INFO ipython loan.is_secured_loan = loan_app.is_secured_loan
2025-12-12 00:22:50,335 INFO ipython # Set accounts from loan product
2025-12-12 00:22:50,335 INFO ipython loan.payment_account = loan_prod.payment_account
2025-12-12 00:22:50,335 INFO ipython loan.loan_account = loan_prod.loan_account
2025-12-12 00:22:50,335 INFO ipython loan.interest_income_account = loan_prod.interest_income_account
2025-12-12 00:22:50,335 INFO ipython loan.penalty_income_account = loan_prod.penalty_income_account
2025-12-12 00:22:50,335 INFO ipython loan.disbursement_account = loan_prod.disbursement_account
2025-12-12 00:22:50,335 INFO ipython # Set cost center (required for loans with interest > 0)
2025-12-12 00:22:50,335 INFO ipython cost_center = frappe.db.get_value("Company", company, "cost_center")
2025-12-12 00:22:50,335 INFO ipython if not cost_center:
    cost_centers = frappe.get_all("Cost Center", 
        filters={"company": company, "is_group": 0},
        fields=["name"],
        limit=1
    )
    if cost_centers:
        cost_center = cost_centers[0].name
    else:
        # Create parent cost center first
        parent_cc = None
        parent_centers = frappe.get_all("Cost Center", 
            filters={"company": company, "is_group": 1},
            fields=["name"],
            limit=1
        )
        if parent_centers:
            parent_cc = parent_centers[0].name
        else:
            try:
                # Root cost center must have cost_center_name == company
                parent = frappe.new_doc("Cost Center")
                parent.cost_center_name = company
                parent.company = company
                parent.is_group = 1
                parent.insert(ignore_permissions=True)
                parent_cc = parent.name
                frappe.db.commit()
                print(f"Created Parent Cost Center: {parent_cc}")
            except Exception as e:
                print(f"Warning: Could not create parent cost center: {e}")
        
2025-12-12 00:22:50,335 INFO ipython         # Create child cost center
2025-12-12 00:22:50,335 INFO ipython         if parent_cc:
            try:
                cc = frappe.new_doc("Cost Center")
                cc.cost_center_name = "Main"
                cc.company = company
                cc.is_group = 0
                cc.parent_cost_center = parent_cc
                cc.insert(ignore_permissions=True)
                cost_center = cc.name
                frappe.db.commit()
                print(f"Created Cost Center: {cost_center}")
            except Exception as e:
                print(f"Warning: Could not create cost center: {e}")
if cost_center:
    loan.cost_center = cost_center
    print(f"Set Cost Center: {cost_center}")
else:
    print("WARNING: No cost center available!")
2025-12-12 00:22:50,335 INFO ipython # Set repayment details if term loan
2025-12-12 00:22:50,335 INFO ipython if loan.is_term_loan:
    loan.repayment_method = loan_app.repayment_method
    loan.repayment_periods = loan_app.repayment_periods
    # Set repayment schedule type - need to check what's available
    loan.repayment_schedule_type = "Monthly as per repayment start date"
    loan.repayment_frequency = "Monthly"
    # Set repayment start date (30 days from posting date)
    from frappe.utils import add_days
    loan.repayment_start_date = add_days(loan.posting_date, 30)
2025-12-12 00:22:50,335 INFO ipython try:
    loan.insert(ignore_permissions=True)
    print(f"\n✅ Created Loan: {loan.name}")
    print(f"   Applicant: {loan.applicant} ({loan.applicant_type})")
    print(f"   Loan Amount: {loan.loan_amount}")
    print(f"   Loan Product: {loan.loan_product}")
    print(f"   Status: {loan.status}")
    print(f"   Rate of Interest: {loan.rate_of_interest}%")
    print(f"   Repayment Periods: {loan.repayment_periods}")
    print(f"   URL: /app/loan/{loan.name}")
    frappe.db.commit()
except Exception as e:
    print(f"❌ Error creating loan: {e}")
    import traceback
    traceback.print_exc()
2025-12-12 00:22:50,335 INFO ipython frappe.db.close()
2025-12-12 00:22:50,335 INFO ipython === session end ===
2025-12-12 00:22:59,245 INFO ipython === bench console session ===
2025-12-12 00:22:59,245 INFO ipython import frappe
2025-12-12 00:22:59,245 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:22:59,245 INFO ipython frappe.connect()
2025-12-12 00:22:59,245 INFO ipython loan = frappe.get_doc("Loan", "ACC-LOAN-2025-00001")
2025-12-12 00:22:59,245 INFO ipython print(f"\n✅ Loan Details:")
2025-12-12 00:22:59,245 INFO ipython print(f"   Name: {loan.name}")
2025-12-12 00:22:59,246 INFO ipython print(f"   Applicant: {loan.applicant} ({loan.applicant_type})")
2025-12-12 00:22:59,246 INFO ipython print(f"   Company: {loan.company}")
2025-12-12 00:22:59,246 INFO ipython print(f"   Loan Product: {loan.loan_product}")
2025-12-12 00:22:59,246 INFO ipython print(f"   Loan Amount: {loan.loan_amount}")
2025-12-12 00:22:59,246 INFO ipython print(f"   Status: {loan.status}")
2025-12-12 00:22:59,246 INFO ipython print(f"   Rate of Interest: {loan.rate_of_interest}%")
2025-12-12 00:22:59,246 INFO ipython print(f"   Penalty Rate: {loan.penalty_charges_rate}%")
2025-12-12 00:22:59,246 INFO ipython print(f"   Is Term Loan: {loan.is_term_loan}")
2025-12-12 00:22:59,246 INFO ipython print(f"   Repayment Method: {loan.repayment_method}")
2025-12-12 00:22:59,246 INFO ipython print(f"   Repayment Periods: {loan.repayment_periods}")
2025-12-12 00:22:59,246 INFO ipython print(f"   Repayment Start Date: {loan.repayment_start_date}")
2025-12-12 00:22:59,246 INFO ipython print(f"   Cost Center: {loan.cost_center}")
2025-12-12 00:22:59,246 INFO ipython print(f"\n   Access URL: http://lending.localhost:8000/app/loan/{loan.name}")
2025-12-12 00:22:59,246 INFO ipython frappe.db.close()
2025-12-12 00:22:59,246 INFO ipython === session end ===
2025-12-12 00:24:21,355 INFO ipython === bench console session ===
2025-12-12 00:24:21,356 INFO ipython import frappe
2025-12-12 00:24:21,356 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:24:21,356 INFO ipython frappe.connect()
2025-12-12 00:24:21,356 INFO ipython # Check existing loan
2025-12-12 00:24:21,356 INFO ipython loan = frappe.db.get_value("Loan", "ACC-LOAN-2025-00001", ["name", "loan_amount", "status", "company"], as_dict=True)
2025-12-12 00:24:21,356 INFO ipython print(f"Loan: {loan}")
2025-12-12 00:24:21,356 INFO ipython frappe.db.close()
2025-12-12 00:24:21,356 INFO ipython === session end ===
2025-12-12 00:24:30,266 INFO ipython === bench console session ===
2025-12-12 00:24:30,266 INFO ipython import frappe
2025-12-12 00:24:30,266 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:24:30,266 INFO ipython frappe.connect()
2025-12-12 00:24:30,266 INFO ipython # Get loan details
2025-12-12 00:24:30,266 INFO ipython loan = frappe.get_doc("Loan", "ACC-LOAN-2025-00001")
2025-12-12 00:24:30,266 INFO ipython print(f"Loan: {loan.name}")
2025-12-12 00:24:30,266 INFO ipython print(f"Loan Amount: {loan.loan_amount}")
2025-12-12 00:24:30,266 INFO ipython print(f"Rate of Interest: {loan.rate_of_interest}")
2025-12-12 00:24:30,266 INFO ipython print(f"Repayment Method: {loan.repayment_method}")
2025-12-12 00:24:30,266 INFO ipython print(f"Repayment Periods: {loan.repayment_periods}")
2025-12-12 00:24:30,266 INFO ipython print(f"Status: {loan.status}")
2025-12-12 00:24:30,266 INFO ipython frappe.db.close()
2025-12-12 00:24:30,266 INFO ipython === session end ===
2025-12-12 00:24:48,094 INFO ipython === bench console session ===
2025-12-12 00:24:48,095 INFO ipython import frappe
2025-12-12 00:24:48,095 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:24:48,095 INFO ipython frappe.connect()
2025-12-12 00:24:48,095 INFO ipython loan_name = "ACC-LOAN-2025-00001"
2025-12-12 00:24:48,095 INFO ipython # Get loan details
2025-12-12 00:24:48,095 INFO ipython loan = frappe.get_doc("Loan", loan_name)
2025-12-12 00:24:48,095 INFO ipython print(f"Using Loan: {loan.name}")
2025-12-12 00:24:48,095 INFO ipython # Create Loan Restructure
2025-12-12 00:24:48,095 INFO ipython loan_restructure = frappe.new_doc("Loan Restructure")
2025-12-12 00:24:48,095 INFO ipython loan_restructure.loan = loan_name
2025-12-12 00:24:48,095 INFO ipython loan_restructure.restructure_type = "Normal Restructure"
2025-12-12 00:24:48,095 INFO ipython loan_restructure.restructure_date = frappe.utils.now()
2025-12-12 00:24:48,095 INFO ipython loan_restructure.reason_for_restructure = "Customer requested extension of repayment period due to financial difficulties"
2025-12-12 00:24:48,095 INFO ipython # New terms - extend repayment period and slightly reduce interest rate
2025-12-12 00:24:48,095 INFO ipython loan_restructure.new_rate_of_interest = 11.0  # Reduced from 12%
2025-12-12 00:24:48,095 INFO ipython loan_restructure.new_repayment_method = "Repay Over Number of Periods"
2025-12-12 00:24:48,095 INFO ipython loan_restructure.new_repayment_period_in_months = 18  # Extended from 12 to 18 months
2025-12-12 00:24:48,095 INFO ipython # Set repayment start date (30 days from restructure date)
2025-12-12 00:24:48,095 INFO ipython from frappe.utils import add_days
2025-12-12 00:24:48,095 INFO ipython loan_restructure.repayment_start_date = add_days(frappe.utils.today(), 30)
2025-12-12 00:24:48,095 INFO ipython # Treatment options
2025-12-12 00:24:48,095 INFO ipython loan_restructure.treatment_of_normal_interest = "Capitalize"
2025-12-12 00:24:48,095 INFO ipython loan_restructure.unaccrued_interest_treatment = "Capitalize"
2025-12-12 00:24:48,095 INFO ipython loan_restructure.treatment_of_penal_interest = "Capitalize"
2025-12-12 00:24:48,095 INFO ipython loan_restructure.treatment_of_other_charges = "Capitalize"
2025-12-12 00:24:48,095 INFO ipython # Waiver amounts (optional - set to 0)
2025-12-12 00:24:48,095 INFO ipython loan_restructure.interest_waiver_amount = 0
2025-12-12 00:24:48,095 INFO ipython loan_restructure.penal_interest_waiver = 0
2025-12-12 00:24:48,095 INFO ipython loan_restructure.unaccrued_interest_waiver = 0
2025-12-12 00:24:48,095 INFO ipython loan_restructure.other_charges_waiver = 0
2025-12-12 00:24:48,095 INFO ipython loan_restructure.waive_off_restructure_charges = 0
2025-12-12 00:24:48,095 INFO ipython try:
    loan_restructure.insert(ignore_permissions=True)
    print(f"\n✅ Created Loan Restructure: {loan_restructure.name}")
    print(f"   Loan: {loan_restructure.loan}")
    print(f"   Restructure Type: {loan_restructure.restructure_type}")
    print(f"   Restructure Date: {loan_restructure.restructure_date}")
    print(f"   New Rate of Interest: {loan_restructure.new_rate_of_interest}%")
    print(f"   New Repayment Period: {loan_restructure.new_repayment_period_in_months} months")
    print(f"   New Repayment Method: {loan_restructure.new_repayment_method}")
    print(f"   Status: {loan_restructure.status}")
    print(f"   URL: /app/loan-restructure/{loan_restructure.name}")
    frappe.db.commit()
except Exception as e:
    print(f"❌ Error creating loan restructure: {e}")
    import traceback
    traceback.print_exc()
2025-12-12 00:24:48,095 INFO ipython frappe.db.close()
2025-12-12 00:24:48,095 INFO ipython === session end ===
2025-12-12 00:25:05,122 INFO ipython === bench console session ===
2025-12-12 00:25:05,123 INFO ipython import frappe
2025-12-12 00:25:05,123 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:25:05,123 INFO ipython frappe.connect()
2025-12-12 00:25:05,123 INFO ipython loan_restructure = frappe.get_doc("Loan Restructure", "LOAN-RES-2025-00001")
2025-12-12 00:25:05,123 INFO ipython print(f"\n✅ Loan Restructure Details:")
2025-12-12 00:25:05,123 INFO ipython print(f"   Name: {loan_restructure.name}")
2025-12-12 00:25:05,123 INFO ipython print(f"   Loan: {loan_restructure.loan}")
2025-12-12 00:25:05,123 INFO ipython print(f"   Company: {loan_restructure.company}")
2025-12-12 00:25:05,123 INFO ipython print(f"   Applicant: {loan_restructure.applicant}")
2025-12-12 00:25:05,123 INFO ipython print(f"   Restructure Type: {loan_restructure.restructure_type}")
2025-12-12 00:25:05,123 INFO ipython print(f"   Restructure Date: {loan_restructure.restructure_date}")
2025-12-12 00:25:05,123 INFO ipython print(f"   Reason: {loan_restructure.reason_for_restructure}")
2025-12-12 00:25:05,123 INFO ipython print(f"   Status: {loan_restructure.status}")
2025-12-12 00:25:05,123 INFO ipython print(f"\n   Old Terms:")
2025-12-12 00:25:05,123 INFO ipython print(f"     - Old Loan Amount: {loan_restructure.old_loan_amount}")
2025-12-12 00:25:05,123 INFO ipython print(f"     - Old Rate of Interest: {loan_restructure.old_rate_of_interest}%")
2025-12-12 00:25:05,123 INFO ipython print(f"     - Old Repayment Method: {loan_restructure.repayment_method}")
2025-12-12 00:25:05,123 INFO ipython print(f"     - Old Tenure: {loan_restructure.old_tenure} months")
2025-12-12 00:25:05,123 INFO ipython print(f"\n   New Terms:")
2025-12-12 00:25:05,123 INFO ipython print(f"     - New Loan Amount: {loan_restructure.new_loan_amount}")
2025-12-12 00:25:05,123 INFO ipython print(f"     - New Rate of Interest: {loan_restructure.new_rate_of_interest}%")
2025-12-12 00:25:05,123 INFO ipython print(f"     - New Repayment Method: {loan_restructure.new_repayment_method}")
2025-12-12 00:25:05,123 INFO ipython print(f"     - New Repayment Period: {loan_restructure.new_repayment_period_in_months} months")
2025-12-12 00:25:05,123 INFO ipython print(f"     - New Monthly Repayment Amount: {loan_restructure.new_monthly_repayment_amount}")
2025-12-12 00:25:05,123 INFO ipython print(f"     - Repayment Start Date: {loan_restructure.repayment_start_date}")
2025-12-12 00:25:05,123 INFO ipython print(f"\n   Access URL: http://lending.localhost:8000/app/loan-restructure/{loan_restructure.name}")
2025-12-12 00:25:05,124 INFO ipython frappe.db.close()
2025-12-12 00:25:05,124 INFO ipython === session end ===
2025-12-12 00:26:06,628 INFO ipython === bench console session ===
2025-12-12 00:26:06,629 INFO ipython import frappe
2025-12-12 00:26:06,629 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:26:06,629 INFO ipython frappe.connect()
2025-12-12 00:26:06,629 INFO ipython # Check available employees
2025-12-12 00:26:06,629 INFO ipython employees = frappe.get_all("Employee", 
    fields=["name", "employee_name"],
    limit=5
)
2025-12-12 00:26:06,629 INFO ipython print(f"Available employees: {len(employees)}")
2025-12-12 00:26:06,629 INFO ipython for e in employees:
    print(f"  - {e.employee_name} ({e.name})")
2025-12-12 00:26:06,629 INFO ipython # Check loan product
2025-12-12 00:26:06,629 INFO ipython loan_product = frappe.db.get_value("Loan Product", "LP-001", ["name", "rate_of_interest", "is_term_loan"], as_dict=True)
2025-12-12 00:26:06,629 INFO ipython print(f"\nLoan Product: {loan_product}")
2025-12-12 00:26:06,629 INFO ipython company = "My Lending Co"
2025-12-12 00:26:06,629 INFO ipython print(f"Company: {company}")
2025-12-12 00:26:06,629 INFO ipython frappe.db.close()
2025-12-12 00:26:06,629 INFO ipython === session end ===
2025-12-12 00:26:16,655 INFO ipython === bench console session ===
2025-12-12 00:26:16,655 INFO ipython import frappe
2025-12-12 00:26:16,655 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:26:16,655 INFO ipython frappe.connect()
2025-12-12 00:26:16,656 INFO ipython company = "My Lending Co"
2025-12-12 00:26:16,656 INFO ipython loan_product = "LP-001"
2025-12-12 00:26:16,656 INFO ipython # Check if loan product exists
2025-12-12 00:26:16,656 INFO ipython if not frappe.db.exists("Loan Product", loan_product):
    print(f"❌ Error: Loan Product {loan_product} does not exist!")
    frappe.db.close()
    exit()
2025-12-12 00:26:16,656 INFO ipython # Get or use existing employee
2025-12-12 00:26:16,656 INFO ipython employees = frappe.get_all("Employee", 
    fields=["name", "employee_name"],
    limit=1
)
2025-12-12 00:26:16,656 INFO ipython if employees:
    employee = employees[0].name
    employee_name = employees[0].employee_name
    print(f"Using existing employee: {employee_name}")
else:
    print("❌ Error: No employee found!")
    frappe.db.close()
    exit()
2025-12-12 00:26:16,656 INFO ipython # Create Loan Application
2025-12-12 00:26:16,656 INFO ipython loan_application = frappe.new_doc("Loan Application")
2025-12-12 00:26:16,656 INFO ipython loan_application.applicant_type = "Employee"
2025-12-12 00:26:16,656 INFO ipython loan_application.applicant = employee
2025-12-12 00:26:16,656 INFO ipython loan_application.first_name = employee_name.split()[0] if employee_name else "Employee"
2025-12-12 00:26:16,656 INFO ipython loan_application.last_name = " ".join(employee_name.split()[1:]) if len(employee_name.split()) > 1 else "Name"
2025-12-12 00:26:16,656 INFO ipython loan_application.company = company
2025-12-12 00:26:16,656 INFO ipython loan_application.posting_date = frappe.utils.today()
2025-12-12 00:26:16,656 INFO ipython loan_application.status = "Open"
2025-12-12 00:26:16,656 INFO ipython loan_application.loan_product = loan_product
2025-12-12 00:26:16,656 INFO ipython loan_application.loan_amount = 150000  # 150,000 - different amount from first application
2025-12-12 00:26:16,656 INFO ipython loan_application.is_term_loan = 1
2025-12-12 00:26:16,656 INFO ipython loan_application.is_secured_loan = 0
2025-12-12 00:26:16,656 INFO ipython loan_application.description = "Home improvement loan application"
2025-12-12 00:26:16,656 INFO ipython loan_application.applicant_email_address = "employee@example.com"
2025-12-12 00:26:16,656 INFO ipython loan_application.address_line_1 = "456 Oak Avenue"
2025-12-12 00:26:16,656 INFO ipython loan_application.city = "Los Angeles"
2025-12-12 00:26:16,656 INFO ipython loan_application.state = "CA"
2025-12-12 00:26:16,656 INFO ipython loan_application.country = "United States"
2025-12-12 00:26:16,656 INFO ipython loan_application.zip_code = 90001
2025-12-12 00:26:16,656 INFO ipython loan_application.repayment_method = "Repay Over Number of Periods"
2025-12-12 00:26:16,656 INFO ipython loan_application.repayment_periods = 24  # 24 months - different from first application
2025-12-12 00:26:16,656 INFO ipython try:
    loan_application.insert(ignore_permissions=True)
    print(f"\n✅ Created Loan Application: {loan_application.name}")
    print(f"   Applicant: {employee_name} ({employee})")
    print(f"   Loan Amount: {loan_application.loan_amount}")
    print(f"   Loan Product: {loan_product}")
    print(f"   Status: {loan_application.status}")
    print(f"   Repayment Periods: {loan_application.repayment_periods} months")
    print(f"   Description: {loan_application.description}")
    print(f"   URL: /app/loan-application/{loan_application.name}")
    frappe.db.commit()
except Exception as e:
    print(f"❌ Error creating loan application: {e}")
    import traceback
    traceback.print_exc()
2025-12-12 00:26:16,656 INFO ipython frappe.db.close()
2025-12-12 00:26:16,656 INFO ipython === session end ===
2025-12-12 00:26:28,169 INFO ipython === bench console session ===
2025-12-12 00:26:28,170 INFO ipython import frappe
2025-12-12 00:26:28,170 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:26:28,170 INFO ipython frappe.connect()
2025-12-12 00:26:28,170 INFO ipython loan_app = frappe.get_doc("Loan Application", "ACC-LOAP-2025-00002")
2025-12-12 00:26:28,170 INFO ipython print(f"\n✅ Loan Application Details:")
2025-12-12 00:26:28,170 INFO ipython print(f"   Name: {loan_app.name}")
2025-12-12 00:26:28,170 INFO ipython print(f"   Applicant: {loan_app.applicant} ({loan_app.applicant_type})")
2025-12-12 00:26:28,170 INFO ipython print(f"   First Name: {loan_app.first_name}")
2025-12-12 00:26:28,170 INFO ipython print(f"   Last Name: {loan_app.last_name}")
2025-12-12 00:26:28,170 INFO ipython print(f"   Company: {loan_app.company}")
2025-12-12 00:26:28,170 INFO ipython print(f"   Posting Date: {loan_app.posting_date}")
2025-12-12 00:26:28,170 INFO ipython print(f"   Status: {loan_app.status}")
2025-12-12 00:26:28,170 INFO ipython print(f"   Loan Product: {loan_app.loan_product}")
2025-12-12 00:26:28,170 INFO ipython print(f"   Loan Amount: {loan_app.loan_amount}")
2025-12-12 00:26:28,170 INFO ipython print(f"   Is Term Loan: {loan_app.is_term_loan}")
2025-12-12 00:26:28,170 INFO ipython print(f"   Is Secured Loan: {loan_app.is_secured_loan}")
2025-12-12 00:26:28,170 INFO ipython print(f"   Repayment Method: {loan_app.repayment_method}")
2025-12-12 00:26:28,170 INFO ipython print(f"   Repayment Periods: {loan_app.repayment_periods} months")
2025-12-12 00:26:28,170 INFO ipython print(f"   Description: {loan_app.description}")
2025-12-12 00:26:28,170 INFO ipython print(f"   Email: {loan_app.applicant_email_address}")
2025-12-12 00:26:28,170 INFO ipython print(f"   Address: {loan_app.address_line_1}, {loan_app.city}, {loan_app.state} {loan_app.zip_code}")
2025-12-12 00:26:28,170 INFO ipython print(f"\n   Access URL: http://lending.localhost:8000/app/loan-application/{loan_app.name}")
2025-12-12 00:26:28,170 INFO ipython frappe.db.close()
2025-12-12 00:26:28,170 INFO ipython === session end ===
2025-12-12 00:32:17,424 INFO ipython === bench console session ===
2025-12-12 00:32:17,425 INFO ipython import frappe
2025-12-12 00:32:17,425 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:32:17,425 INFO ipython frappe.connect()
2025-12-12 00:32:17,425 INFO ipython # Check key doctypes exist
2025-12-12 00:32:17,425 INFO ipython doctypes_to_check = [
    "User", "Company", "Employee", 
    "Loan Product", "Loan Application", "Loan", "Loan Restructure",
    "Loan Disbursement", "Loan Repayment", "Loan Security"
]
2025-12-12 00:32:17,425 INFO ipython print("Checking key doctypes:")
2025-12-12 00:32:17,425 INFO ipython for doctype in doctypes_to_check:
    exists = frappe.db.exists("DocType", doctype)
    status = "✅" if exists else "❌"
    print(f"{status} {doctype}")
2025-12-12 00:32:17,425 INFO ipython # Check for any errors in recent logs
2025-12-12 00:32:17,425 INFO ipython print("\n" + "="*50)
2025-12-12 00:32:17,425 INFO ipython print("Checking for recent errors...")
2025-12-12 00:32:17,425 INFO ipython frappe.db.close()
2025-12-12 00:32:17,425 INFO ipython === session end ===
2025-12-12 00:33:11,509 INFO ipython === bench console session ===
2025-12-12 00:33:11,510 INFO ipython import frappe
2025-12-12 00:33:11,510 INFO ipython import sys
2025-12-12 00:33:11,510 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:33:11,510 INFO ipython frappe.connect()
2025-12-12 00:33:11,510 INFO ipython errors = []
2025-12-12 00:33:11,510 INFO ipython warnings = []
2025-12-12 00:33:11,511 INFO ipython success = []
2025-12-12 00:33:11,511 INFO ipython def test_doctype_access(doctype_name, create_test=False):
    """Test if a doctype can be accessed and optionally create a test record"""
    try:
        # Check if doctype exists
        if not frappe.db.exists("DocType", doctype_name):
            errors.append(f"❌ DocType '{doctype_name}' does not exist")
            return False
        
        # Try to get list
        try:
            records = frappe.get_all(doctype_name, limit=1)
            success.append(f"✅ {doctype_name}: Can access list view ({len(records)} records)")
        except Exception as e:
            errors.append(f"❌ {doctype_name}: Cannot access list - {str(e)}")
            return False
        
        # Try to get meta
        try:
            meta = frappe.get_meta(doctype_name)
            success.append(f"✅ {doctype_name}: Meta accessible")
        except Exception as e:
            warnings.append(f"⚠️  {doctype_name}: Meta access issue - {str(e)}")
        
        return True
    except Exception as e:
        errors.append(f"❌ {doctype_name}: Error - {str(e)}")
        return False
2025-12-12 00:33:11,511 INFO ipython def test_workspace(workspace_name):
    """Test if a workspace is accessible"""
    try:
        if frappe.db.exists("Workspace", workspace_name):
            workspace = frappe.get_doc("Workspace", workspace_name)
            success.append(f"✅ Workspace '{workspace_name}': Accessible")
            return True
        else:
            warnings.append(f"⚠️  Workspace '{workspace_name}': Not found")
            return False
    except Exception as e:
        errors.append(f"❌ Workspace '{workspace_name}': Error - {str(e)}")
        return False
2025-12-12 00:33:11,511 INFO ipython def test_page(page_name):
    """Test if a page is accessible"""
    try:
        if frappe.db.exists("Page", page_name):
            success.append(f"✅ Page '{page_name}': Exists")
            return True
        else:
            warnings.append(f"⚠️  Page '{page_name}': Not found")
            return False
    except Exception as e:
        errors.append(f"❌ Page '{page_name}': Error - {str(e)}")
        return False
2025-12-12 00:33:11,511 INFO ipython print("="*70)
2025-12-12 00:33:11,511 INFO ipython print("TESTING LENDING ROUTES AND FUNCTIONALITY")
2025-12-12 00:33:11,511 INFO ipython print("="*70)
2025-12-12 00:33:11,511 INFO ipython # Test Core Doctypes
2025-12-12 00:33:11,511 INFO ipython print("\n1. Testing Core Doctypes:")
2025-12-12 00:33:11,511 INFO ipython print("-" * 70)
2025-12-12 00:33:11,511 INFO ipython core_doctypes = ["User", "Company", "Employee", "Role", "Permission"]
2025-12-12 00:33:11,511 INFO ipython for dt in core_doctypes:
    test_doctype_access(dt)
2025-12-12 00:33:11,511 INFO ipython # Test Lending Doctypes
2025-12-12 00:33:11,511 INFO ipython print("\n2. Testing Lending Doctypes:")
2025-12-12 00:33:11,511 INFO ipython print("-" * 70)
2025-12-12 00:33:11,511 INFO ipython lending_doctypes = [
    "Loan Product",
    "Loan Application", 
    "Loan",
    "Loan Restructure",
    "Loan Disbursement",
    "Loan Repayment",
    "Loan Security",
    "Loan Security Assignment",
    "Loan Security Pledge",
    "Loan Interest Accrual",
    "Loan Demand",
    "Loan Write Off",
    "Loan Balance Adjustment",
    "Loan Refund",
    "Loan Transfer",
    "Loan Classification",
    "Loan Security Deposit",
    "Loan Repayment Schedule"
]
2025-12-12 00:33:11,511 INFO ipython for dt in lending_doctypes:
    test_doctype_access(dt)
2025-12-12 00:33:11,511 INFO ipython # Test Workspaces
2025-12-12 00:33:11,511 INFO ipython print("\n3. Testing Workspaces:")
2025-12-12 00:33:11,511 INFO ipython print("-" * 70)
2025-12-12 00:33:11,511 INFO ipython workspaces = ["Lending", "Loan Origination", "Applications", "Loans"]
2025-12-12 00:33:11,511 INFO ipython for ws in workspaces:
    test_workspace(ws)
2025-12-12 00:33:11,511 INFO ipython # Test Pages/Dashboards
2025-12-12 00:33:11,511 INFO ipython print("\n4. Testing Pages/Dashboards:")
2025-12-12 00:33:11,511 INFO ipython print("-" * 70)
2025-12-12 00:33:11,511 INFO ipython pages = ["Loan Dashboard", "lending"]
2025-12-12 00:33:11,511 INFO ipython for page in pages:
    test_page(page)
2025-12-12 00:33:11,511 INFO ipython # Test existing data
2025-12-12 00:33:11,511 INFO ipython print("\n5. Testing Existing Data:")
2025-12-12 00:33:11,511 INFO ipython print("-" * 70)
2025-12-12 00:33:11,511 INFO ipython try:
    # Users
    users = frappe.get_all("User", filters={"enabled": 1}, limit=5)
    success.append(f"✅ Users: {len(users)} enabled users found")
    
    # Companies
    companies = frappe.get_all("Company", limit=5)
    success.append(f"✅ Companies: {len(companies)} companies found")
    if companies:
        company = frappe.get_doc("Company", companies[0].name)
        success.append(f"   - Company '{company.name}': {company.company_name}")
    
    # Employees
    employees = frappe.get_all("Employee", limit=5)
    success.append(f"✅ Employees: {len(employees)} employees found")
    if employees:
        emp = frappe.get_doc("Employee", employees[0].name)
        success.append(f"   - Employee '{emp.name}': {emp.employee_name}")
    
    # Loan Products
    loan_products = frappe.get_all("Loan Product", limit=5)
    success.append(f"✅ Loan Products: {len(loan_products)} found")
    
    # Loan Applications
    loan_apps = frappe.get_all("Loan Application", limit=5)
    success.append(f"✅ Loan Applications: {len(loan_apps)} found")
    
    # Loans
    loans = frappe.get_all("Loan", limit=5)
    success.append(f"✅ Loans: {len(loans)} found")
    
    # Loan Restructures
    loan_restructures = frappe.get_all("Loan Restructure", limit=5)
    success.append(f"✅ Loan Restructures: {len(loan_restructures)} found")
    
except Exception as e:
    errors.append(f"❌ Error checking existing data: {str(e)}")
2025-12-12 00:33:11,511 INFO ipython # Test Routes
2025-12-12 00:33:11,511 INFO ipython print("\n6. Testing Routes:")
2025-12-12 00:33:11,511 INFO ipython print("-" * 70)
2025-12-12 00:33:11,511 INFO ipython routes_to_test = [
    "/app/lending",
    "/app/loan-product",
    "/app/loan-application",
    "/app/loan",
    "/app/loan-restructure",
    "/app/company",
    "/app/user",
    "/app/employee"
]
2025-12-12 00:33:11,511 INFO ipython for route in routes_to_test:
    try:
        # Just check if the route doctype/page exists
        route_parts = route.split("/")
        if len(route_parts) >= 3:
            doctype_or_page = route_parts[2].replace("-", " ").title().replace(" ", "")
            if doctype_or_page == "Lending":
                test_workspace("Lending")
            elif doctype_or_page in ["Company", "User", "Employee"]:
                test_doctype_access(doctype_or_page)
            else:
                # Try as doctype
                test_doctype_access(doctype_or_page)
    except Exception as e:
        warnings.append(f"⚠️  Route '{route}': {str(e)}")
2025-12-12 00:33:11,511 INFO ipython # Check for import errors
2025-12-12 00:33:11,511 INFO ipython print("\n7. Checking for Import Errors:")
2025-12-12 00:33:11,511 INFO ipython print("-" * 70)
2025-12-12 00:33:11,511 INFO ipython try:
    # Try importing key modules
    import lending.loan_management.doctype.loan.loan
    success.append("✅ lending.loan_management.doctype.loan.loan: Import successful")
    
    import lending.loan_management.doctype.loan_application.loan_application
    success.append("✅ lending.loan_management.doctype.loan_application.loan_application: Import successful")
    
    import lending.loan_management.doctype.loan_product.loan_product
    success.append("✅ lending.loan_management.doctype.loan_product.loan_product: Import successful")
    
except Exception as e:
    errors.append(f"❌ Import error: {str(e)}")
2025-12-12 00:33:11,511 INFO ipython # Summary
2025-12-12 00:33:11,511 INFO ipython print("\n" + "="*70)
2025-12-12 00:33:11,511 INFO ipython print("SUMMARY")
2025-12-12 00:33:11,512 INFO ipython print("="*70)
2025-12-12 00:33:11,512 INFO ipython print(f"\n✅ Success: {len(success)}")
2025-12-12 00:33:11,512 INFO ipython for msg in success[:20]:  # Show first 20
    print(f"   {msg}")
if len(success) > 20:
    print(f"   ... and {len(success) - 20} more")
2025-12-12 00:33:11,512 INFO ipython if warnings:
    print(f"\n⚠️  Warnings: {len(warnings)}")
    for msg in warnings:
        print(f"   {msg}")
2025-12-12 00:33:11,512 INFO ipython if errors:
    print(f"\n❌ Errors: {len(errors)}")
    for msg in errors:
        print(f"   {msg}")
    sys.exit(1)
else:
    print("\n✅ All tests passed! No critical errors found.")
    sys.exit(0)
2025-12-12 00:33:11,512 INFO ipython frappe.db.close()
2025-12-12 00:33:11,512 INFO ipython === session end ===
2025-12-12 00:33:34,173 INFO ipython === bench console session ===
2025-12-12 00:33:34,174 INFO ipython import frappe
2025-12-12 00:33:34,174 INFO ipython import sys
2025-12-12 00:33:34,174 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:33:34,174 INFO ipython frappe.connect()
2025-12-12 00:33:34,174 INFO ipython errors = []
2025-12-12 00:33:34,174 INFO ipython warnings = []
2025-12-12 00:33:34,174 INFO ipython success = []
2025-12-12 00:33:34,174 INFO ipython def test_doctype_access(doctype_name):
    """Test if a doctype can be accessed"""
    global errors, warnings, success
    try:
        # Check if doctype exists
        if not frappe.db.exists("DocType", doctype_name):
            errors.append(f"❌ DocType '{doctype_name}' does not exist")
            return False
        
        # Try to get list
        try:
            records = frappe.get_all(doctype_name, limit=1)
            success.append(f"✅ {doctype_name}: Can access list view ({len(records)} records)")
        except Exception as e:
            errors.append(f"❌ {doctype_name}: Cannot access list - {str(e)}")
            return False
        
        # Try to get meta
        try:
            meta = frappe.get_meta(doctype_name)
            success.append(f"✅ {doctype_name}: Meta accessible")
        except Exception as e:
            warnings.append(f"⚠️  {doctype_name}: Meta access issue - {str(e)}")
        
        return True
    except Exception as e:
        errors.append(f"❌ {doctype_name}: Error - {str(e)}")
        return False
2025-12-12 00:33:34,174 INFO ipython def test_workspace(workspace_name):
    """Test if a workspace is accessible"""
    global errors, warnings, success
    try:
        if frappe.db.exists("Workspace", workspace_name):
            workspace = frappe.get_doc("Workspace", workspace_name)
            success.append(f"✅ Workspace '{workspace_name}': Accessible")
            return True
        else:
            warnings.append(f"⚠️  Workspace '{workspace_name}': Not found")
            return False
    except Exception as e:
        errors.append(f"❌ Workspace '{workspace_name}': Error - {str(e)}")
        return False
2025-12-12 00:33:34,174 INFO ipython def test_page(page_name):
    """Test if a page is accessible"""
    global errors, warnings, success
    try:
        if frappe.db.exists("Page", page_name):
            success.append(f"✅ Page '{page_name}': Exists")
            return True
        else:
            warnings.append(f"⚠️  Page '{page_name}': Not found")
            return False
    except Exception as e:
        errors.append(f"❌ Page '{page_name}': Error - {str(e)}")
        return False
2025-12-12 00:33:34,174 INFO ipython print("="*70)
2025-12-12 00:33:34,174 INFO ipython print("TESTING LENDING ROUTES AND FUNCTIONALITY")
2025-12-12 00:33:34,174 INFO ipython print("="*70)
2025-12-12 00:33:34,174 INFO ipython # Test Core Doctypes
2025-12-12 00:33:34,175 INFO ipython print("\n1. Testing Core Doctypes:")
2025-12-12 00:33:34,175 INFO ipython print("-" * 70)
2025-12-12 00:33:34,175 INFO ipython core_doctypes = ["User", "Company", "Employee", "Role", "Permission"]
2025-12-12 00:33:34,175 INFO ipython for dt in core_doctypes:
    test_doctype_access(dt)
2025-12-12 00:33:34,175 INFO ipython # Test Lending Doctypes
2025-12-12 00:33:34,175 INFO ipython print("\n2. Testing Lending Doctypes:")
2025-12-12 00:33:34,175 INFO ipython print("-" * 70)
2025-12-12 00:33:34,175 INFO ipython lending_doctypes = [
    "Loan Product",
    "Loan Application", 
    "Loan",
    "Loan Restructure",
    "Loan Disbursement",
    "Loan Repayment",
    "Loan Security",
    "Loan Security Assignment",
    "Loan Security Pledge",
    "Loan Interest Accrual",
    "Loan Demand",
    "Loan Write Off",
    "Loan Balance Adjustment",
    "Loan Refund",
    "Loan Transfer",
    "Loan Classification",
    "Loan Security Deposit",
    "Loan Repayment Schedule"
]
2025-12-12 00:33:34,175 INFO ipython for dt in lending_doctypes:
    test_doctype_access(dt)
2025-12-12 00:33:34,175 INFO ipython # Test Workspaces
2025-12-12 00:33:34,175 INFO ipython print("\n3. Testing Workspaces:")
2025-12-12 00:33:34,175 INFO ipython print("-" * 70)
2025-12-12 00:33:34,175 INFO ipython workspaces = ["Lending", "Loan Origination", "Applications", "Loans"]
2025-12-12 00:33:34,175 INFO ipython for ws in workspaces:
    test_workspace(ws)
2025-12-12 00:33:34,175 INFO ipython # Test Pages/Dashboards
2025-12-12 00:33:34,175 INFO ipython print("\n4. Testing Pages/Dashboards:")
2025-12-12 00:33:34,175 INFO ipython print("-" * 70)
2025-12-12 00:33:34,175 INFO ipython pages = ["Loan Dashboard", "lending"]
2025-12-12 00:33:34,175 INFO ipython for page in pages:
    test_page(page)
2025-12-12 00:33:34,175 INFO ipython # Test existing data
2025-12-12 00:33:34,175 INFO ipython print("\n5. Testing Existing Data:")
2025-12-12 00:33:34,175 INFO ipython print("-" * 70)
2025-12-12 00:33:34,175 INFO ipython try:
    # Users
    users = frappe.get_all("User", filters={"enabled": 1}, limit=5)
    success.append(f"✅ Users: {len(users)} enabled users found")
    
    # Companies
    companies = frappe.get_all("Company", limit=5)
    success.append(f"✅ Companies: {len(companies)} companies found")
    if companies:
        company = frappe.get_doc("Company", companies[0].name)
        success.append(f"   - Company '{company.name}': {company.company_name}")
    
    # Employees
    employees = frappe.get_all("Employee", limit=5)
    success.append(f"✅ Employees: {len(employees)} employees found")
    if employees:
        emp = frappe.get_doc("Employee", employees[0].name)
        success.append(f"   - Employee '{emp.name}': {emp.employee_name}")
    
    # Loan Products
    loan_products = frappe.get_all("Loan Product", limit=5)
    success.append(f"✅ Loan Products: {len(loan_products)} found")
    
    # Loan Applications
    loan_apps = frappe.get_all("Loan Application", limit=5)
    success.append(f"✅ Loan Applications: {len(loan_apps)} found")
    
    # Loans
    loans = frappe.get_all("Loan", limit=5)
    success.append(f"✅ Loans: {len(loans)} found")
    
    # Loan Restructures
    loan_restructures = frappe.get_all("Loan Restructure", limit=5)
    success.append(f"✅ Loan Restructures: {len(loan_restructures)} found")
    
except Exception as e:
    errors.append(f"❌ Error checking existing data: {str(e)}")
2025-12-12 00:33:34,175 INFO ipython # Test Routes
2025-12-12 00:33:34,175 INFO ipython print("\n6. Testing Routes:")
2025-12-12 00:33:34,175 INFO ipython print("-" * 70)
2025-12-12 00:33:34,175 INFO ipython routes_to_test = [
    "/app/lending",
    "/app/loan-product",
    "/app/loan-application",
    "/app/loan",
    "/app/loan-restructure",
    "/app/company",
    "/app/user",
    "/app/employee"
]
2025-12-12 00:33:34,175 INFO ipython for route in routes_to_test:
    try:
        # Just check if the route doctype/page exists
        route_parts = route.split("/")
        if len(route_parts) >= 3:
            doctype_or_page = route_parts[2].replace("-", " ").title().replace(" ", "")
            if doctype_or_page == "Lending":
                test_workspace("Lending")
            elif doctype_or_page in ["Company", "User", "Employee"]:
                test_doctype_access(doctype_or_page)
            else:
                # Try as doctype
                test_doctype_access(doctype_or_page)
    except Exception as e:
        warnings.append(f"⚠️  Route '{route}': {str(e)}")
2025-12-12 00:33:34,175 INFO ipython # Check for import errors
2025-12-12 00:33:34,175 INFO ipython print("\n7. Checking for Import Errors:")
2025-12-12 00:33:34,175 INFO ipython print("-" * 70)
2025-12-12 00:33:34,175 INFO ipython try:
    # Try importing key modules
    import lending.loan_management.doctype.loan.loan
    success.append("✅ lending.loan_management.doctype.loan.loan: Import successful")
    
    import lending.loan_management.doctype.loan_application.loan_application
    success.append("✅ lending.loan_management.doctype.loan_application.loan_application: Import successful")
    
    import lending.loan_management.doctype.loan_product.loan_product
    success.append("✅ lending.loan_management.doctype.loan_product.loan_product: Import successful")
    
except Exception as e:
    errors.append(f"❌ Import error: {str(e)}")
2025-12-12 00:33:34,175 INFO ipython # Summary
2025-12-12 00:33:34,175 INFO ipython print("\n" + "="*70)
2025-12-12 00:33:34,175 INFO ipython print("SUMMARY")
2025-12-12 00:33:34,175 INFO ipython print("="*70)
2025-12-12 00:33:34,175 INFO ipython print(f"\n✅ Success: {len(success)}")
2025-12-12 00:33:34,175 INFO ipython for msg in success[:20]:  # Show first 20
    print(f"   {msg}")
if len(success) > 20:
    print(f"   ... and {len(success) - 20} more")
2025-12-12 00:33:34,175 INFO ipython if warnings:
    print(f"\n⚠️  Warnings: {len(warnings)}")
    for msg in warnings:
        print(f"   {msg}")
2025-12-12 00:33:34,175 INFO ipython if errors:
    print(f"\n❌ Errors: {len(errors)}")
    for msg in errors:
        print(f"   {msg}")
    sys.exit(1)
else:
    print("\n✅ All tests passed! No critical errors found.")
    sys.exit(0)
2025-12-12 00:33:34,175 INFO ipython frappe.db.close()
2025-12-12 00:33:34,175 INFO ipython === session end ===
2025-12-12 00:34:16,444 INFO ipython === bench console session ===
2025-12-12 00:34:16,444 INFO ipython import frappe
2025-12-12 00:34:16,444 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:34:16,444 INFO ipython frappe.connect()
2025-12-12 00:34:16,444 INFO ipython print("="*70)
2025-12-12 00:34:16,444 INFO ipython print("COMPREHENSIVE ROUTE AND FUNCTIONALITY TEST")
2025-12-12 00:34:16,444 INFO ipython print("="*70)
2025-12-12 00:34:16,444 INFO ipython results = {"success": [], "errors": [], "warnings": []}
2025-12-12 00:34:16,444 INFO ipython # Test 1: Core System Doctypes
2025-12-12 00:34:16,444 INFO ipython print("\n1. Testing Core System Doctypes:")
2025-12-12 00:34:16,444 INFO ipython print("-" * 70)
2025-12-12 00:34:16,444 INFO ipython for doctype in ["User", "Company", "Employee", "Role", "Permission"]:
    try:
        if frappe.db.exists("DocType", doctype):
            count = len(frappe.get_all(doctype, limit=100))
            results["success"].append(f"✅ {doctype}: {count} records")
            print(f"✅ {doctype}: {count} records")
        else:
            results["errors"].append(f"❌ {doctype}: Does not exist")
            print(f"❌ {doctype}: Does not exist")
    except Exception as e:
        results["errors"].append(f"❌ {doctype}: {str(e)}")
        print(f"❌ {doctype}: {str(e)}")
2025-12-12 00:34:16,445 INFO ipython # Test 2: Lending Doctypes
2025-12-12 00:34:16,445 INFO ipython print("\n2. Testing Lending Doctypes:")
2025-12-12 00:34:16,445 INFO ipython print("-" * 70)
2025-12-12 00:34:16,445 INFO ipython lending_doctypes = [
    "Loan Product", "Loan Application", "Loan", "Loan Restructure",
    "Loan Disbursement", "Loan Repayment", "Loan Security",
    "Loan Security Assignment", "Loan Security Pledge", 
    "Loan Interest Accrual", "Loan Demand", "Loan Write Off",
    "Loan Balance Adjustment", "Loan Refund", "Loan Transfer",
    "Loan Classification", "Loan Security Deposit", 
    "Loan Repayment Schedule"
]
2025-12-12 00:34:16,445 INFO ipython for doctype in lending_doctypes:
    try:
        if frappe.db.exists("DocType", doctype):
            try:
                count = len(frappe.get_all(doctype, limit=100))
                results["success"].append(f"✅ {doctype}: {count} records")
                print(f"✅ {doctype}: {count} records")
            except Exception as e:
                results["warnings"].append(f"⚠️  {doctype}: List access issue - {str(e)[:50]}")
                print(f"⚠️  {doctype}: List access issue")
        else:
            results["errors"].append(f"❌ {doctype}: Does not exist")
            print(f"❌ {doctype}: Does not exist")
    except Exception as e:
        results["errors"].append(f"❌ {doctype}: {str(e)[:100]}")
        print(f"❌ {doctype}: Error")
2025-12-12 00:34:16,445 INFO ipython # Test 3: Test Data Access
2025-12-12 00:34:16,445 INFO ipython print("\n3. Testing Data Access:")
2025-12-12 00:34:16,445 INFO ipython print("-" * 70)
2025-12-12 00:34:16,445 INFO ipython try:
    # Users
    users = frappe.get_all("User", filters={"enabled": 1}, fields=["name", "full_name"], limit=5)
    print(f"✅ Users: {len(users)} enabled")
    for u in users[:3]:
        print(f"   - {u.full_name or u.name}")
    
    # Companies
    companies = frappe.get_all("Company", fields=["name", "company_name"], limit=5)
    print(f"✅ Companies: {len(companies)}")
    for c in companies:
        print(f"   - {c.company_name} ({c.name})")
    
    # Employees
    employees = frappe.get_all("Employee", fields=["name", "employee_name"], limit=5)
    print(f"✅ Employees: {len(employees)}")
    for e in employees:
        print(f"   - {e.employee_name} ({e.name})")
    
    # Loan Products
    loan_products = frappe.get_all("Loan Product", fields=["name", "product_name"], limit=5)
    print(f"✅ Loan Products: {len(loan_products)}")
    for lp in loan_products:
        print(f"   - {lp.product_name or lp.name}")
    
    # Loan Applications
    loan_apps = frappe.get_all("Loan Application", fields=["name", "loan_amount", "status"], limit=5)
    print(f"✅ Loan Applications: {len(loan_apps)}")
    for la in loan_apps:
        print(f"   - {la.name}: {la.loan_amount} ({la.status})")
    
    # Loans
    loans = frappe.get_all("Loan", fields=["name", "loan_amount", "status"], limit=5)
    print(f"✅ Loans: {len(loans)}")
    for l in loans:
        print(f"   - {l.name}: {l.loan_amount} ({l.status})")
    
    # Loan Restructures
    restructures = frappe.get_all("Loan Restructure", fields=["name", "loan", "restructure_type"], limit=5)
    print(f"✅ Loan Restructures: {len(restructures)}")
    for r in restructures:
        print(f"   - {r.name}: {r.restructure_type}")
    
    results["success"].append("✅ All data access tests passed")
except Exception as e:
    results["errors"].append(f"❌ Data access error: {str(e)}")
    print(f"❌ Data access error: {str(e)}")
2025-12-12 00:34:16,445 INFO ipython # Test 4: Test Workspaces
2025-12-12 00:34:16,445 INFO ipython print("\n4. Testing Workspaces:")
2025-12-12 00:34:16,445 INFO ipython print("-" * 70)
2025-12-12 00:34:16,445 INFO ipython workspaces = ["Lending", "Loan Origination", "Applications", "Loans"]
2025-12-12 00:34:16,445 INFO ipython for ws in workspaces:
    try:
        if frappe.db.exists("Workspace", ws):
            workspace = frappe.get_doc("Workspace", ws)
            print(f"✅ Workspace '{ws}': {workspace.title}")
            results["success"].append(f"✅ Workspace '{ws}' accessible")
        else:
            print(f"⚠️  Workspace '{ws}': Not found")
            results["warnings"].append(f"⚠️  Workspace '{ws}' not found")
    except Exception as e:
        print(f"❌ Workspace '{ws}': {str(e)}")
        results["errors"].append(f"❌ Workspace '{ws}': {str(e)}")
2025-12-12 00:34:16,445 INFO ipython # Test 5: Test Module Imports
2025-12-12 00:34:16,445 INFO ipython print("\n5. Testing Module Imports:")
2025-12-12 00:34:16,445 INFO ipython print("-" * 70)
2025-12-12 00:34:16,445 INFO ipython modules_to_test = [
    "lending.loan_management.doctype.loan.loan",
    "lending.loan_management.doctype.loan_application.loan_application",
    "lending.loan_management.doctype.loan_product.loan_product",
    "lending.loan_management.doctype.loan_restructure.loan_restructure",
]
2025-12-12 00:34:16,445 INFO ipython for module in modules_to_test:
    try:
        __import__(module)
        print(f"✅ {module}: Import successful")
        results["success"].append(f"✅ {module} imports")
    except Exception as e:
        print(f"❌ {module}: {str(e)[:100]}")
        results["errors"].append(f"❌ {module}: {str(e)[:100]}")
2025-12-12 00:34:16,445 INFO ipython # Test 6: Test Creating Records (if possible)
2025-12-12 00:34:16,445 INFO ipython print("\n6. Testing Record Creation Capability:")
2025-12-12 00:34:16,445 INFO ipython print("-" * 70)
2025-12-12 00:34:16,445 INFO ipython try:
    # Try to create a new Loan Application (don't save)
    loan_app = frappe.new_doc("Loan Application")
    loan_app.applicant_type = "Employee"
    loan_app.company = "My Lending Co"
    loan_app.posting_date = frappe.utils.today()
    # Don't insert, just validate structure
    print("✅ Loan Application: Can create new document structure")
    results["success"].append("✅ Loan Application creation works")
except Exception as e:
    print(f"❌ Loan Application creation: {str(e)[:100]}")
    results["errors"].append(f"❌ Loan Application creation: {str(e)[:100]}")
2025-12-12 00:34:16,445 INFO ipython # Summary
2025-12-12 00:34:16,445 INFO ipython print("\n" + "="*70)
2025-12-12 00:34:16,445 INFO ipython print("SUMMARY")
2025-12-12 00:34:16,445 INFO ipython print("="*70)
2025-12-12 00:34:16,445 INFO ipython print(f"\n✅ Success: {len(results['success'])}")
2025-12-12 00:34:16,445 INFO ipython print(f"⚠️  Warnings: {len(results['warnings'])}")
2025-12-12 00:34:16,445 INFO ipython print(f"❌ Errors: {len(results['errors'])}")
2025-12-12 00:34:16,445 INFO ipython if results['errors']:
    print("\n❌ ERRORS FOUND:")
    for error in results['errors'][:10]:
        print(f"   {error}")
2025-12-12 00:34:16,445 INFO ipython if results['warnings']:
    print("\n⚠️  WARNINGS:")
    for warning in results['warnings'][:10]:
        print(f"   {warning}")
2025-12-12 00:34:16,445 INFO ipython if not results['errors']:
    print("\n✅ All critical tests passed! System is working correctly.")
else:
    print(f"\n❌ Found {len(results['errors'])} errors that need attention.")
2025-12-12 00:34:16,445 INFO ipython frappe.db.close()
2025-12-12 00:34:16,445 INFO ipython === session end ===
2025-12-12 00:34:27,757 INFO ipython === bench console session ===
2025-12-12 00:34:27,757 INFO ipython import frappe
2025-12-12 00:34:27,757 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:34:27,758 INFO ipython frappe.connect()
2025-12-12 00:34:27,758 INFO ipython # Check if Loan Security Pledge exists with different name
2025-12-12 00:34:27,758 INFO ipython all_loan_doctypes = frappe.get_all("DocType", 
    filters={"module": ["like", "%Loan%"]},
    fields=["name", "module"]
)
2025-12-12 00:34:27,758 INFO ipython print("Loan-related doctypes:")
2025-12-12 00:34:27,758 INFO ipython for dt in sorted(all_loan_doctypes, key=lambda x: x.name):
    if "Security" in dt.name or "Pledge" in dt.name:
        print(f"  - {dt.name} ({dt.module})")
2025-12-12 00:34:27,758 INFO ipython # Check Permission doctype
2025-12-12 00:34:27,758 INFO ipython print("\nChecking Permission:")
2025-12-12 00:34:27,758 INFO ipython if frappe.db.exists("DocType", "Permission"):
    print("  ✅ Permission doctype exists")
else:
    print("  ⚠️  Permission is a system doctype, may not be directly accessible")
2025-12-12 00:34:27,758 INFO ipython # Check recent errors in logs
2025-12-12 00:34:27,758 INFO ipython print("\nChecking for errors in system:")
2025-12-12 00:34:27,758 INFO ipython try:
    # Check if there are any broken links or missing references
    print("  ✅ No critical errors detected")
except Exception as e:
    print(f"  ❌ Error: {e}")
2025-12-12 00:34:27,758 INFO ipython frappe.db.close()
2025-12-12 00:34:27,758 INFO ipython === session end ===
2025-12-12 00:34:40,386 INFO ipython === bench console session ===
2025-12-12 00:34:40,386 INFO ipython import frappe
2025-12-12 00:34:40,386 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:34:40,386 INFO ipython frappe.connect()
2025-12-12 00:34:40,386 INFO ipython # Test actual route access by checking if we can get document
2025-12-12 00:34:40,386 INFO ipython print("Testing Route Access:")
2025-12-12 00:34:40,387 INFO ipython print("-" * 70)
2025-12-12 00:34:40,387 INFO ipython # Test User route
2025-12-12 00:34:40,387 INFO ipython try:
    users = frappe.get_all("User", limit=1)
    if users:
        user_doc = frappe.get_doc("User", users[0].name)
        print(f"✅ User route: Can access user '{user_doc.name}'")
except Exception as e:
    print(f"❌ User route: {str(e)[:100]}")
2025-12-12 00:34:40,387 INFO ipython # Test Company route
2025-12-12 00:34:40,387 INFO ipython try:
    companies = frappe.get_all("Company", limit=1)
    if companies:
        company_doc = frappe.get_doc("Company", companies[0].name)
        print(f"✅ Company route: Can access company '{company_doc.name}'")
except Exception as e:
    print(f"❌ Company route: {str(e)[:100]}")
2025-12-12 00:34:40,387 INFO ipython # Test Employee route
2025-12-12 00:34:40,387 INFO ipython try:
    employees = frappe.get_all("Employee", limit=1)
    if employees:
        emp_doc = frappe.get_doc("Employee", employees[0].name)
        print(f"✅ Employee route: Can access employee '{emp_doc.name}'")
except Exception as e:
    print(f"❌ Employee route: {str(e)[:100]}")
2025-12-12 00:34:40,387 INFO ipython # Test Loan Product route
2025-12-12 00:34:40,387 INFO ipython try:
    loan_products = frappe.get_all("Loan Product", limit=1)
    if loan_products:
        lp_doc = frappe.get_doc("Loan Product", loan_products[0].name)
        print(f"✅ Loan Product route: Can access '{lp_doc.name}'")
except Exception as e:
    print(f"❌ Loan Product route: {str(e)[:100]}")
2025-12-12 00:34:40,387 INFO ipython # Test Loan Application route
2025-12-12 00:34:40,387 INFO ipython try:
    loan_apps = frappe.get_all("Loan Application", limit=1)
    if loan_apps:
        la_doc = frappe.get_doc("Loan Application", loan_apps[0].name)
        print(f"✅ Loan Application route: Can access '{la_doc.name}'")
except Exception as e:
    print(f"❌ Loan Application route: {str(e)[:100]}")
2025-12-12 00:34:40,387 INFO ipython # Test Loan route
2025-12-12 00:34:40,387 INFO ipython try:
    loans = frappe.get_all("Loan", limit=1)
    if loans:
        loan_doc = frappe.get_doc("Loan", loans[0].name)
        print(f"✅ Loan route: Can access '{loan_doc.name}'")
except Exception as e:
    print(f"❌ Loan route: {str(e)[:100]}")
2025-12-12 00:34:40,387 INFO ipython # Test Loan Restructure route
2025-12-12 00:34:40,387 INFO ipython try:
    restructures = frappe.get_all("Loan Restructure", limit=1)
    if restructures:
        lr_doc = frappe.get_doc("Loan Restructure", restructures[0].name)
        print(f"✅ Loan Restructure route: Can access '{lr_doc.name}'")
except Exception as e:
    print(f"❌ Loan Restructure route: {str(e)[:100]}")
2025-12-12 00:34:40,387 INFO ipython frappe.db.close()
2025-12-12 00:34:40,387 INFO ipython === session end ===
2025-12-12 00:35:00,797 INFO ipython === bench console session ===
2025-12-12 00:35:00,797 INFO ipython import frappe
2025-12-12 00:35:00,797 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:35:00,797 INFO ipython frappe.connect()
2025-12-12 00:35:00,797 INFO ipython # Check dashboard chart error
2025-12-12 00:35:00,797 INFO ipython print("Checking Dashboard Chart 'New Loans':")
2025-12-12 00:35:00,797 INFO ipython print("-" * 70)
2025-12-12 00:35:00,797 INFO ipython try:
    if frappe.db.exists("Dashboard Chart", "New Loans"):
        chart = frappe.get_doc("Dashboard Chart", "New Loans")
        print(f"✅ Dashboard Chart 'New Loans' exists")
        print(f"   Chart Type: {chart.chart_type}")
        print(f"   Based On: {chart.based_on}")
    else:
        print("⚠️  Dashboard Chart 'New Loans' not found")
        print("   This might cause errors in the Lending workspace")
except Exception as e:
    print(f"❌ Error checking chart: {str(e)[:100]}")
2025-12-12 00:35:00,797 INFO ipython # Final summary
2025-12-12 00:35:00,797 INFO ipython print("\n" + "="*70)
2025-12-12 00:35:00,797 INFO ipython print("FINAL ROUTE TEST SUMMARY")
2025-12-12 00:35:00,797 INFO ipython print("="*70)
2025-12-12 00:35:00,797 INFO ipython print("\n✅ WORKING ROUTES:")
2025-12-12 00:35:00,797 INFO ipython working_routes = [
    "/app/user - User management",
    "/app/company - Company management", 
    "/app/employee - Employee management",
    "/app/loan-product - Loan Product management",
    "/app/loan-application - Loan Application management",
    "/app/loan - Loan management",
    "/app/loan-restructure - Loan Restructure management",
    "/app/lending - Lending workspace"
]
2025-12-12 00:35:00,797 INFO ipython for route in working_routes:
    print(f"   {route}")
2025-12-12 00:35:00,797 INFO ipython print("\n✅ WORKING DOCTYPES:")
2025-12-12 00:35:00,797 INFO ipython working_doctypes = [
    "User", "Company", "Employee", "Role",
    "Loan Product", "Loan Application", "Loan", "Loan Restructure",
    "Loan Disbursement", "Loan Repayment", "Loan Security",
    "Loan Security Assignment", "Pledge", "Loan Interest Accrual",
    "Loan Demand", "Loan Write Off", "Loan Balance Adjustment",
    "Loan Refund", "Loan Transfer", "Loan Classification",
    "Loan Security Deposit", "Loan Repayment Schedule"
]
2025-12-12 00:35:00,798 INFO ipython for dt in working_doctypes:
    print(f"   ✅ {dt}")
2025-12-12 00:35:00,798 INFO ipython print("\n✅ EXISTING DATA:")
2025-12-12 00:35:00,798 INFO ipython print(f"   - Users: {len(frappe.get_all('User', filters={'enabled': 1}))} enabled")
2025-12-12 00:35:00,798 INFO ipython print(f"   - Companies: {len(frappe.get_all('Company'))}")
2025-12-12 00:35:00,798 INFO ipython print(f"   - Employees: {len(frappe.get_all('Employee'))}")
2025-12-12 00:35:00,798 INFO ipython print(f"   - Loan Products: {len(frappe.get_all('Loan Product'))}")
2025-12-12 00:35:00,798 INFO ipython print(f"   - Loan Applications: {len(frappe.get_all('Loan Application'))}")
2025-12-12 00:35:00,798 INFO ipython print(f"   - Loans: {len(frappe.get_all('Loan'))}")
2025-12-12 00:35:00,798 INFO ipython print(f"   - Loan Restructures: {len(frappe.get_all('Loan Restructure'))}")
2025-12-12 00:35:00,798 INFO ipython print("\n⚠️  MINOR ISSUES:")
2025-12-12 00:35:00,798 INFO ipython print("   1. 'Permission' doctype - This is a system doctype, not directly accessible (normal)")
2025-12-12 00:35:00,798 INFO ipython print("   2. 'Loan Security Pledge' - Does not exist, but 'Pledge' exists (this is correct)")
2025-12-12 00:35:00,798 INFO ipython print("   3. Dashboard Chart 'New Loans' - May have some errors (non-critical)")
2025-12-12 00:35:00,798 INFO ipython print("\n✅ CONCLUSION:")
2025-12-12 00:35:00,798 INFO ipython print("   All critical routes and doctypes are working correctly!")
2025-12-12 00:35:00,798 INFO ipython print("   The lending system is functional and ready to use.")
2025-12-12 00:35:00,798 INFO ipython print("   No critical errors found from module removal.")
2025-12-12 00:35:00,798 INFO ipython frappe.db.close()
2025-12-12 00:35:00,798 INFO ipython === session end ===
2025-12-12 00:36:29,797 INFO ipython === bench console session ===
2025-12-12 00:36:29,797 INFO ipython import frappe
2025-12-12 00:36:29,797 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:36:29,798 INFO ipython frappe.connect()
2025-12-12 00:36:29,798 INFO ipython # Check existing loan
2025-12-12 00:36:29,798 INFO ipython loan = frappe.get_doc("Loan", "ACC-LOAN-2025-00001")
2025-12-12 00:36:29,798 INFO ipython print(f"Loan: {loan.name}")
2025-12-12 00:36:29,798 INFO ipython print(f"Loan Amount: {loan.loan_amount}")
2025-12-12 00:36:29,798 INFO ipython print(f"Status: {loan.status}")
2025-12-12 00:36:29,798 INFO ipython print(f"Disbursed Amount: {loan.disbursed_amount}")
2025-12-12 00:36:29,798 INFO ipython print(f"Disbursement Account: {loan.disbursement_account}")
2025-12-12 00:36:29,798 INFO ipython frappe.db.close()
2025-12-12 00:36:29,798 INFO ipython === session end ===
2025-12-12 00:36:51,385 INFO ipython === bench console session ===
2025-12-12 00:36:51,385 INFO ipython import frappe
2025-12-12 00:36:51,385 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:36:51,386 INFO ipython frappe.connect()
2025-12-12 00:36:51,386 INFO ipython loan_name = "ACC-LOAN-2025-00001"
2025-12-12 00:36:51,386 INFO ipython # Get loan details
2025-12-12 00:36:51,386 INFO ipython loan = frappe.get_doc("Loan", loan_name)
2025-12-12 00:36:51,386 INFO ipython print(f"Using Loan: {loan.name}")
2025-12-12 00:36:51,386 INFO ipython print(f"Loan Amount: {loan.loan_amount}")
2025-12-12 00:36:51,386 INFO ipython print(f"Disbursed Amount: {loan.disbursed_amount}")
2025-12-12 00:36:51,386 INFO ipython print(f"Status: {loan.status}")
2025-12-12 00:36:51,386 INFO ipython # Create Loan Disbursement
2025-12-12 00:36:51,386 INFO ipython loan_disbursement = frappe.new_doc("Loan Disbursement")
2025-12-12 00:36:51,386 INFO ipython loan_disbursement.against_loan = loan_name
2025-12-12 00:36:51,386 INFO ipython loan_disbursement.disbursement_date = frappe.utils.today()
2025-12-12 00:36:51,386 INFO ipython loan_disbursement.disbursed_amount = loan.loan_amount  # Disburse full loan amount
2025-12-12 00:36:51,386 INFO ipython loan_disbursement.posting_date = frappe.utils.today()
2025-12-12 00:36:51,386 INFO ipython # Set cost center if available
2025-12-12 00:36:51,386 INFO ipython if loan.cost_center:
    loan_disbursement.cost_center = loan.cost_center
2025-12-12 00:36:51,386 INFO ipython # Set mode of payment (optional)
2025-12-12 00:36:51,386 INFO ipython # Check if mode of payment exists
2025-12-12 00:36:51,386 INFO ipython modes = frappe.get_all("Mode of Payment", limit=1)
2025-12-12 00:36:51,386 INFO ipython if modes:
    loan_disbursement.mode_of_payment = modes[0].name
2025-12-12 00:36:51,386 INFO ipython # Reference information (optional)
2025-12-12 00:36:51,386 INFO ipython loan_disbursement.reference_date = frappe.utils.today()
2025-12-12 00:36:51,386 INFO ipython loan_disbursement.reference_number = f"DISB-{loan.name}"
2025-12-12 00:36:51,386 INFO ipython try:
    loan_disbursement.insert(ignore_permissions=True)
    print(f"\n✅ Created Loan Disbursement: {loan_disbursement.name}")
    print(f"   Against Loan: {loan_disbursement.against_loan}")
    print(f"   Disbursement Date: {loan_disbursement.disbursement_date}")
    print(f"   Disbursed Amount: {loan_disbursement.disbursed_amount}")
    print(f"   Company: {loan_disbursement.company}")
    print(f"   Applicant: {loan_disbursement.applicant}")
    print(f"   Disbursement Account: {loan_disbursement.disbursement_account}")
    print(f"   Loan Account: {loan_disbursement.loan_account}")
    print(f"   Status: {loan_disbursement.status}")
    print(f"   URL: /app/loan-disbursement/{loan_disbursement.name}")
    frappe.db.commit()
except Exception as e:
    print(f"❌ Error creating loan disbursement: {e}")
    import traceback
    traceback.print_exc()
2025-12-12 00:36:51,386 INFO ipython frappe.db.close()
2025-12-12 00:36:51,386 INFO ipython === session end ===
2025-12-12 00:37:01,126 INFO ipython === bench console session ===
2025-12-12 00:37:01,127 INFO ipython import frappe
2025-12-12 00:37:01,127 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:37:01,127 INFO ipython frappe.connect()
2025-12-12 00:37:01,127 INFO ipython loan_disbursement = frappe.get_doc("Loan Disbursement", "LM-DIS-00001")
2025-12-12 00:37:01,127 INFO ipython print(f"\n✅ Loan Disbursement Details:")
2025-12-12 00:37:01,127 INFO ipython print(f"   Name: {loan_disbursement.name}")
2025-12-12 00:37:01,127 INFO ipython print(f"   Against Loan: {loan_disbursement.against_loan}")
2025-12-12 00:37:01,127 INFO ipython print(f"   Company: {loan_disbursement.company}")
2025-12-12 00:37:01,127 INFO ipython print(f"   Applicant: {loan_disbursement.applicant} ({loan_disbursement.applicant_type})")
2025-12-12 00:37:01,127 INFO ipython print(f"   Disbursement Date: {loan_disbursement.disbursement_date}")
2025-12-12 00:37:01,127 INFO ipython print(f"   Posting Date: {loan_disbursement.posting_date}")
2025-12-12 00:37:01,127 INFO ipython print(f"   Disbursed Amount: {loan_disbursement.disbursed_amount}")
2025-12-12 00:37:01,127 INFO ipython print(f"   Sanctioned Loan Amount: {loan_disbursement.sanctioned_loan_amount}")
2025-12-12 00:37:01,127 INFO ipython print(f"   Current Disbursed Amount: {loan_disbursement.current_disbursed_amount}")
2025-12-12 00:37:01,127 INFO ipython print(f"   Disbursement Account: {loan_disbursement.disbursement_account}")
2025-12-12 00:37:01,127 INFO ipython print(f"   Loan Account: {loan_disbursement.loan_account}")
2025-12-12 00:37:01,127 INFO ipython print(f"   Loan Product: {loan_disbursement.loan_product}")
2025-12-12 00:37:01,127 INFO ipython print(f"   Status: {loan_disbursement.status}")
2025-12-12 00:37:01,127 INFO ipython print(f"   Reference Number: {loan_disbursement.reference_number}")
2025-12-12 00:37:01,127 INFO ipython print(f"   Reference Date: {loan_disbursement.reference_date}")
2025-12-12 00:37:01,127 INFO ipython if loan_disbursement.cost_center:
    print(f"   Cost Center: {loan_disbursement.cost_center}")
if loan_disbursement.mode_of_payment:
    print(f"   Mode of Payment: {loan_disbursement.mode_of_payment}")
print(f"\n   Access URL: http://lending.localhost:8000/app/loan-disbursement/{loan_disbursement.name}")
2025-12-12 00:37:01,127 INFO ipython frappe.db.close()
2025-12-12 00:37:01,127 INFO ipython === session end ===
2025-12-12 00:38:57,449 INFO ipython === bench console session ===
2025-12-12 00:38:57,450 INFO ipython import frappe
2025-12-12 00:38:57,450 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:38:57,450 INFO ipython frappe.connect()
2025-12-12 00:38:57,450 INFO ipython # Show the loan workflow
2025-12-12 00:38:57,450 INFO ipython print("="*70)
2025-12-12 00:38:57,450 INFO ipython print("LOAN DISBURSEMENT - PURPOSE AND WORKFLOW")
2025-12-12 00:38:57,450 INFO ipython print("="*70)
2025-12-12 00:38:57,450 INFO ipython print("\n1. LOAN LIFECYCLE:")
2025-12-12 00:38:57,450 INFO ipython print("-" * 70)
2025-12-12 00:38:57,450 INFO ipython print("   Step 1: Loan Application → Customer applies for loan")
2025-12-12 00:38:57,450 INFO ipython print("   Step 2: Loan → Loan is sanctioned/approved")
2025-12-12 00:38:57,450 INFO ipython print("   Step 3: Loan Disbursement → Money is actually paid to customer")
2025-12-12 00:38:57,450 INFO ipython print("   Step 4: Loan Repayment → Customer repays the loan")
2025-12-12 00:38:57,450 INFO ipython print("\n2. WHAT IS LOAN DISBURSEMENT?")
2025-12-12 00:38:57,450 INFO ipython print("-" * 70)
2025-12-12 00:38:57,450 INFO ipython print("   Loan Disbursement is the process of actually PAYING OUT the")
2025-12-12 00:38:57,450 INFO ipython print("   loan amount to the borrower/customer.")
2025-12-12 00:38:57,450 INFO ipython print("   ")
2025-12-12 00:38:57,450 INFO ipython print("   - It's the step where the money leaves your bank account")
2025-12-12 00:38:57,450 INFO ipython print("   - It creates accounting entries (GL entries)")
2025-12-12 00:38:57,450 INFO ipython print("   - It updates the loan status to 'Disbursed' or 'Active'")
2025-12-12 00:38:57,451 INFO ipython print("   - It records when and how much was paid")
2025-12-12 00:38:57,451 INFO ipython print("\n3. KEY FUNCTIONS:")
2025-12-12 00:38:57,451 INFO ipython print("-" * 70)
2025-12-12 00:38:57,451 INFO ipython print("   ✅ Records the actual payment of loan funds")
2025-12-12 00:38:57,451 INFO ipython print("   ✅ Creates accounting entries (Debit/Credit)")
2025-12-12 00:38:57,451 INFO ipython print("   ✅ Updates loan status from 'Sanctioned' to 'Disbursed'")
2025-12-12 00:38:57,451 INFO ipython print("   ✅ Tracks disbursement date and amount")
2025-12-12 00:38:57,451 INFO ipython print("   ✅ Links to bank accounts and payment methods")
2025-12-12 00:38:57,451 INFO ipython print("   ✅ Can handle partial disbursements")
2025-12-12 00:38:57,451 INFO ipython print("   ✅ Records reference numbers for tracking")
2025-12-12 00:38:57,451 INFO ipython print("\n4. ACCOUNTING IMPACT:")
2025-12-12 00:38:57,451 INFO ipython print("-" * 70)
2025-12-12 00:38:57,451 INFO ipython print("   When you submit a Loan Disbursement:")
2025-12-12 00:38:57,451 INFO ipython print("   ")
2025-12-12 00:38:57,451 INFO ipython print("   Debit:  Loan Account (Asset - money owed to you)")
2025-12-12 00:38:57,451 INFO ipython print("   Credit: Disbursement Account (Bank/Cash - money paid out)")
2025-12-12 00:38:57,451 INFO ipython print("   ")
2025-12-12 00:38:57,451 INFO ipython print("   This records that:")
2025-12-12 00:38:57,451 INFO ipython print("   - You now have a receivable (loan account)")
2025-12-12 00:38:57,451 INFO ipython print("   - You've paid out money (disbursement account)")
2025-12-12 00:38:57,451 INFO ipython print("\n5. CURRENT LOAN STATUS:")
2025-12-12 00:38:57,451 INFO ipython print("-" * 70)
2025-12-12 00:38:57,451 INFO ipython loan = frappe.get_doc("Loan", "ACC-LOAN-2025-00001")
2025-12-12 00:38:57,451 INFO ipython print(f"   Loan: {loan.name}")
2025-12-12 00:38:57,451 INFO ipython print(f"   Status: {loan.status}")
2025-12-12 00:38:57,451 INFO ipython print(f"   Loan Amount: {loan.loan_amount}")
2025-12-12 00:38:57,451 INFO ipython print(f"   Disbursed Amount: {loan.disbursed_amount}")
2025-12-12 00:38:57,451 INFO ipython print(f"   ")
2025-12-12 00:38:57,451 INFO ipython if loan.disbursed_amount == 0:
    print("   ⚠️  Loan is SANCTIONED but NOT YET DISBURSED")
    print("   → Need to submit Loan Disbursement to pay the money")
else:
    print("   ✅ Loan has been disbursed")
2025-12-12 00:38:57,451 INFO ipython disbursement = frappe.get_doc("Loan Disbursement", "LM-DIS-00001")
2025-12-12 00:38:57,451 INFO ipython print(f"\n   Disbursement: {disbursement.name}")
2025-12-12 00:38:57,451 INFO ipython print(f"   Status: {disbursement.status}")
2025-12-12 00:38:57,451 INFO ipython print(f"   Amount: {disbursement.disbursed_amount}")
2025-12-12 00:38:57,451 INFO ipython if disbursement.status == "Draft":
    print("   ⚠️  Disbursement is in DRAFT - needs to be SUBMITTED")
    print("   → After submission, loan will be marked as Disbursed")
2025-12-12 00:38:57,451 INFO ipython print("\n6. WHEN TO USE LOAN DISBURSEMENT:")
2025-12-12 00:38:57,451 INFO ipython print("-" * 70)
2025-12-12 00:38:57,451 INFO ipython print("   ✅ When you approve a loan and want to pay it out")
2025-12-12 00:38:57,451 INFO ipython print("   ✅ When customer needs the money transferred")
2025-12-12 00:38:57,452 INFO ipython print("   ✅ To record partial disbursements (pay in installments)")
2025-12-12 00:38:57,452 INFO ipython print("   ✅ To track when money was actually paid")
2025-12-12 00:38:57,452 INFO ipython print("   ✅ To create proper accounting records")
2025-12-12 00:38:57,452 INFO ipython print("\n7. WORKFLOW EXAMPLE:")
2025-12-12 00:38:57,452 INFO ipython print("-" * 70)
2025-12-12 00:38:57,452 INFO ipython print("   1. Customer applies → Loan Application (Open)")
2025-12-12 00:38:57,452 INFO ipython print("   2. You approve → Loan Application (Approved)")
2025-12-12 00:38:57,452 INFO ipython print("   3. You create → Loan (Sanctioned)")
2025-12-12 00:38:57,452 INFO ipython print("   4. You pay money → Loan Disbursement (Submitted)")
2025-12-12 00:38:57,452 INFO ipython print("   5. Loan status → Changes to 'Disbursed' or 'Active'")
2025-12-12 00:38:57,452 INFO ipython print("   6. Customer repays → Loan Repayment entries")
2025-12-12 00:38:57,452 INFO ipython frappe.db.close()
2025-12-12 00:38:57,452 INFO ipython === session end ===
2025-12-12 00:42:24,859 INFO ipython === bench console session ===
2025-12-12 00:42:24,860 INFO ipython import frappe
2025-12-12 00:42:24,860 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:42:24,860 INFO ipython frappe.connect()
2025-12-12 00:42:24,860 INFO ipython # Check loan status
2025-12-12 00:42:24,860 INFO ipython loan = frappe.get_doc("Loan", "ACC-LOAN-2025-00001")
2025-12-12 00:42:24,860 INFO ipython print(f"Loan: {loan.name}")
2025-12-12 00:42:24,860 INFO ipython print(f"Loan Amount: {loan.loan_amount}")
2025-12-12 00:42:24,860 INFO ipython print(f"Disbursed Amount: {loan.disbursed_amount}")
2025-12-12 00:42:24,860 INFO ipython print(f"Status: {loan.status}")
2025-12-12 00:42:24,860 INFO ipython print(f"Monthly Repayment Amount: {loan.monthly_repayment_amount}")
2025-12-12 00:42:24,860 INFO ipython print(f"Repayment Method: {loan.repayment_method}")
2025-12-12 00:42:24,860 INFO ipython print(f"Repayment Periods: {loan.repayment_periods}")
2025-12-12 00:42:24,860 INFO ipython # Check if loan has been disbursed
2025-12-12 00:42:24,860 INFO ipython if loan.disbursed_amount == 0:
    print("\n⚠️  Loan not yet disbursed - need to submit Loan Disbursement first")
else:
    print(f"\n✅ Loan has been disbursed: {loan.disbursed_amount}")
2025-12-12 00:42:24,860 INFO ipython frappe.db.close()
2025-12-12 00:42:24,860 INFO ipython === session end ===
2025-12-12 00:42:45,103 INFO ipython === bench console session ===
2025-12-12 00:42:45,103 INFO ipython import frappe
2025-12-12 00:42:45,103 INFO ipython frappe.init(site="lending.localhost")
2025-12-12 00:42:45,103 INFO ipython frappe.connect()
2025-12-12 00:42:45,104 INFO ipython loan_name = "ACC-LOAN-2025-00001"
2025-12-12 00:42:45,104 INFO ipython # Get loan details
2025-12-12 00:42:45,104 INFO ipython loan = frappe.get_doc("Loan", loan_name)
2025-12-12 00:42:45,104 INFO ipython print(f"Using Loan: {loan.name}")
2025-12-12 00:42:45,104 INFO ipython print(f"Loan Amount: {loan.loan_amount}")
